<form xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
    <xf:switch>
        <xf:case id="referencesPanel" selected="true">
            <xf:label>Références</xf:label>
            <xf:group ref="instance('xprModel')/xpr:sourceDesc/xpr:idno">
                <xf:label>Identifiants</xf:label>
                <xf:input bind="unitid" incremental="true">
                    <xf:label>Cote</xf:label>
                    <xf:help>La cote doit respecter le format suivant : Z1JXXX</xf:help>
                    <!--<xf:hint>La cote doit respecter le format suivant : Z1JXXX</xf:hint>-->
                    <xf:alert>Le champ cote est requis.</xf:alert>
                </xf:input>
                <xf:input bind="item" incremental="true">
                    <xf:label>Dossier</xf:label>
                </xf:input>
            </xf:group>
            <xf:group ref="instance('xprModel')/xpr:sourceDesc/xpr:facsimile">
                <xf:label>Identifiants des vues</xf:label>
                <xf:input bind="facsimileFrom" incremental="true">
                    <xf:label>Première vue</xf:label>
                </xf:input>
                <xf:input bind="facsimileTo" incremental="true">
                    <xf:label>Dernière vue</xf:label>
                </xf:input>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:sourceDesc, 'yes')"/>
                        </pre>
            <xf:label>Description physique du procès-verbal et des pièces annexes</xf:label>
            <xf:group>
                <xf:input bind="extent" incremental="true">
                    <xf:label>Nombre de cahiers et de feuillets</xf:label>
                </xf:input>
                <xf:select1 bind="sketch" appearance="full">
                    <xf:label>Croquis sur le procès-verbal</xf:label>
                    <xf:item>
                        <xf:label>oui</xf:label>
                        <xf:value>true</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>non</xf:label>
                        <xf:value>false</xf:value>
                    </xf:item>
                    <!--<xf:help>Ceci est un message d'aide</xf:help>-->
                </xf:select1>
                <!--<xf:range ref="instance('xprRanges')/xpr:range[@type='sketch']/@n" start="1" end="3" step="1" incremental="true">
                                <xf:label>Croquis sur le procès-verbal <xf:output value="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/xpr:extent/@sketch"/></xf:label>
                                <xf:action ev:event="xforms-value-changed" if="instance('xprRanges')/xpr:range[@type='sketch']/@n='1'">
                                    <xf:setvalue ref="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/xpr:extent/@sketch">true</xf:setvalue>
                                </xf:action>
                                <xf:action ev:event="xforms-value-changed" if="instance('xprRanges')/xpr:range[@type='sketch']/@n='2'">
                                    <xf:setvalue ref="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/xpr:extent/@sketch"/>
                                </xf:action>
                                <xf:action ev:event="xforms-value-changed" if="instance('xprRanges')/xpr:range[@type='sketch']/@n='3'">
                                    <xf:setvalue ref="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/xpr:extent/@sketch">false</xf:setvalue>
                                </xf:action>
                            </xf:range>-->
            </xf:group>
            <xf:trigger bind="addAppendice">
                <xf:label>Ajouter une annexe</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:delete nodeset="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/xpr:appendices"/>
                    <xf:insert origin="instance('xprSupplement')/xpr:appendices" nodeset="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/*" at="last()" position="after"/>
                    <!--<xf:insert nodeset="instance('xprAppendices')"/>-->
                </xf:action>
                <xf:help>Ajouter une annexe.</xf:help>
            </xf:trigger>
            <xf:group ref="xpr:sourceDesc/xpr:physDesc/xpr:appendices">
                <xf:label>Pièces annexes</xf:label>
                <!--@rmq Pourra servir au contrôle à partir des informations tirées du récolement. -->
                <xf:output value="count(//xpr:sourceDesc/xpr:physDesc/xpr:appendices/xpr:appendice)">
                    <xf:label>Nombre de pièces annexes</xf:label>
                </xf:output>
                <xf:repeat id="repeatAppendice" bind="appendice" appearance="full">
                    <xf:repeat id="repeatAppendiceType" nodeset="xpr:type">
                        <xf:select1 ref="@type">
                            <!--@bug il existe l'attribut selection="open" pour ces cas mais il ne semble pas fonctionner. Il permet de préciser une valeur qui ne serait pas dans la liste.-->
                            <!-- https://sourceforge.net/p/xsltforms/mailman/message/24465876/ -->
                            <xf:label>Type de pièce annexe</xf:label>
                            <xf:item>
                                <xf:label>Dessin</xf:label>
                                <xf:value>drawing</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Dessin</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Plan</xf:label>
                                <xf:value>plan</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Plan</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Croquis</xf:label>
                                <xf:value>sketch</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Croquis</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Brouillon</xf:label>
                                <xf:value>rough</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Brouillon</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Pouvoir/procuration (acte sous seing privé)</xf:label>
                                <xf:value>proxyPA</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Pouvoir/procuration (acte sous seing privé)</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Pouvoir/procuration (acte notarié)</xf:label>
                                <xf:value>proxyNA</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Pouvoir/procuration (acte notarié)</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Requête</xf:label>
                                <xf:value>petition</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">Requête</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Autre</xf:label>
                                <xf:value>other</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:type">À préciser</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:select1>
                        <xf:input ref=".[@type='other']" incremental="true"> </xf:input>
                        <xf:trigger class="delete">
                            <xf:label>&#10007;</xf:label>
                            <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:sourceDesc/xpr:physDesc/xpr:appendices/xpr:appendice/xpr:type) > 1"/>
                            <xf:help>Supprimer un type d'annexe.</xf:help>
                        </xf:trigger>
                    </xf:repeat>
                    <xf:trigger class="insert">
                        <xf:label>Ajouter un type</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert nodeset="xpr:type" at="index('repeatAppendiceType')" position="after"/>
                            <xf:setvalue ref="xpr:type[index('repeatAppendiceType')]" value=""/>
                            <xf:setvalue ref="xpr:type[index('repeatAppendiceType')]/@type" value=""/>
                        </xf:action>
                        <xf:help>Ajouter un type d'annexe.</xf:help>
                    </xf:trigger>
                    <!--@todo appendice autre-->
                    <xf:input ref="xpr:extent" incremental="true">
                        <xf:label>Nombre de feuillets</xf:label>
                    </xf:input>
                    <xf:textarea ref="xpr:desc" incremental="true">
                        <xf:label>Description physique</xf:label>
                    </xf:textarea>
                    <xf:textarea ref="xpr:note" incremental="true">
                        <xf:label>Commentaires</xf:label>
                    </xf:textarea>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer une annexe</xf:label>
                        <xf:delete nodeset="parent::xpr:appendices" if="count(//xpr:sourceDesc/xpr:physDesc/xpr:appendices/xpr:appendice) = 1" ev:event="DOMActivate"/>
                        <xf:delete nodeset="." at="1" if="count(//xpr:sourceDesc/xpr:physDesc/xpr:appendices/xpr:appendice) > 1" ev:event="DOMActivate"/>
                        <xf:help>Supprimer une annexe.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter une pièce annexe</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:appendice" at="index('repeatAppendice')" position="after" ev:event="DOMActivate"/>
                        <xf:delete ref="xpr:appendice[index('repeatAppendice')]/xpr:type[position() &gt; 1]"/>
                        <xf:setvalue ref="xpr:appendice[index('repeatAppendice')]/xpr:type" value=""/>
                        <xf:setvalue ref="xpr:appendice[index('repeatAppendice')]/xpr:type/@type" value=""/>
                        <xf:setvalue ref="xpr:appendice[index('repeatAppendice')]/xpr:extent" value=""/>
                        <xf:setvalue ref="xpr:appendice[index('repeatAppendice')]/xpr:desc" value=""/>
                        <xf:setvalue ref="xpr:appendice[index('repeatAppendice')]/xpr:note" value=""/>
                    </xf:action>
                    <xf:help>Ajouter une pièce annexe.</xf:help>
                </xf:trigger>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:sourceDesc/xpr:physDesc, 'yes')"/>
                        </pre>
        </xf:case>
        <xf:case id="sessionsPanel" selected="false">
            <xf:label>Vacations</xf:label>
            <xf:group ref="xpr:description/xpr:sessions">
                <xf:repeat id="repeatSession" bind="sessionsDate">
                    <xf:input ref="@when" incremental="true">
                        <xf:label>Date</xf:label>
                        <xf:alert>La date indiquée ne respecte pas le format requis.</xf:alert>
                        <xf:hint>La date indiquée doit respecter les formats suivants : AAAA-MM-JJ ou JJ/MM/AAAA</xf:hint>
                        <xf:help>Vous pouvez vous aider du calendrier pour sélectionner directement une date.</xf:help>
                    </xf:input>
                    <xf:select1 ref="@type">
                        <xf:label>Lieu</xf:label>
                        <xf:item>
                            <xf:label>Paris et faubourgs</xf:label>
                            <xf:value>paris</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Banlieue</xf:label>
                            <xf:value>suburbs</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Campagne</xf:label>
                            <xf:value>province</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:sessions/xpr:date) > 1"/>
                        <xf:help>Supprimer une vacation.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter une vacation</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:date" at="index('repeatSession')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:date[index('repeatSession')]/@when" value=""/>
                        <xf:setvalue ref="xpr:date[index('repeatSession')]/@type" value=""/>
                    </xf:action>
                    <xf:help>Ajouter une vacation.</xf:help>
                </xf:trigger>
            </xf:group>
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:sessions, 'yes')"/>
                        </pre>
            <xf:label>Lieux de l’expertise</xf:label>
            <xf:group ref="xpr:description/xpr:places">
                <xf:repeat id="repeatPlace" bind="place" appearance="full">
                    <xf:select1 ref="@type">
                        <xf:label>Lieux de l’expertise</xf:label>
                        <xf:item>
                            <xf:label>Paris</xf:label>
                            <xf:value>paris</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Banlieue</xf:label>
                            <xf:value>suburbs</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Campagne</xf:label>
                            <xf:value>province</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Bureau des experts</xf:label>
                            <xf:value>office</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Bureau du greffier</xf:label>
                            <xf:value>clerkOffice</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Indéterminé</xf:label>
                            <xf:value>indeterminate</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:input ref="xpr:address/xpr:street" incremental="true">
                        <xf:label>Voie</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:address/xpr:buildingNumber" incremental="true">
                        <xf:label>Numéro de la voie</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:complement" incremental="true">
                        <xf:label>Précisions géographiques</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:parish" incremental="true">
                        <xf:label>Paroisse</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:city" incremental="true">
                        <xf:label>Ville</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:district" incremental="true">
                        <xf:label>Département</xf:label>
                    </xf:input>
                    <xf:repeat id="repeatOwner" nodeset="xpr:owner" appearance="full">
                        <xf:input ref="." incremental="true">
                            <xf:label>Propriétaire</xf:label>
                        </xf:input>
                        <xf:trigger class="delete">
                            <xf:label>Supprimer un propriétaire</xf:label>
                            <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:places/xpr:place[index('repeatPlace')]/xpr:owner) > 1"/>
                            <xf:help>Supprimer un propriétaire.</xf:help>
                        </xf:trigger>
                    </xf:repeat>
                    <xf:trigger class="insert" ref="//xpr:place[index('repeatPlace')][@type='paris' or @type='suburbs' or @type='province' or @type='indeterminate']">
                        <xf:label>Ajouter un propriétaire</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert nodeset="xpr:owner" at="index('repeatOwner')" position="after" ev:event="DOMActivate"/>
                            <xf:setvalue ref="xpr:owner[index('repeatOwner')]" value=""/>
                        </xf:action>
                        <xf:help>Ajouter un propriétaire.</xf:help>
                    </xf:trigger>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer un lieu</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:places/xpr:place) > 1"/>
                        <xf:help>Supprimer un lieu.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un lieu</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:place" at="index('repeatPlace')" position="after" ev:event="DOMActivate"/>
                        <!--<xf:setvalue ref="xpr:place[index('repeatPlace')]/@type" value=""/>-->
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:address/xpr:street" value=""/>
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:address/xpr:buildingNumber" value=""/>
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:complement" value=""/>
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:parish" value=""/>
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:city" value=""/>
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:province" value=""/>
                        <xf:setvalue ref="xpr:place[index('repeatPlace')]/xpr:owner" value=""/>
                        <xf:delete ref="xpr:place[index('repeatPlace')]/xpr:owner[position() &gt; 1]"/>
                    </xf:action>
                    <xf:help>Ajouter un lieu.</xf:help>
                </xf:trigger>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:places, 'yes')"/>
                        </pre>
        </xf:case>
        <xf:case id="procedurePanel" selected="false">
            <xf:group ref="instance('xprSupplement')/xpr:categories">
                <xf:label>Types d’expertise</xf:label>
                <xf:select ref="xpr:category" appearance="full">
                    <xf:label>Catégories d’expertise</xf:label>
                    <xf:item>
                        <xf:label>Estimer la valeur des biens</xf:label>
                        <xf:value>estimation</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:insert context="instance('xprModel')/xpr:description/xpr:categories" origin="instance('xprSupplement')/xpr:categories/xpr:category[@type='estimation']"/>
                        </xf:action>
                        <xf:action ev:event="xforms-deselect">
                            <xf:delete ref="instance('xprModel')/xpr:description/xpr:categories/xpr:category[@type='estimation']"/>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Recevoir et évaluer le travail réalisé</xf:label>
                        <xf:value>acceptation</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:insert context="instance('xprModel')/xpr:description/xpr:categories" origin="instance('xprSupplement')/xpr:categories/xpr:category[@type='acceptation']"/>
                        </xf:action>
                        <xf:action ev:event="xforms-deselect">
                            <xf:delete ref="instance('xprModel')/xpr:description/xpr:categories/xpr:category[@type='acceptation']"/>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Enregistrer</xf:label>
                        <xf:value>registration</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:insert context="instance('xprModel')/xpr:description/xpr:categories" origin="instance('xprSupplement')/xpr:categories/xpr:category[@type='registration']"/>
                        </xf:action>
                        <xf:action ev:event="xforms-deselect">
                            <xf:delete ref="instance('xprModel')/xpr:description/xpr:categories/xpr:category[@type='registration']"/>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Départager</xf:label>
                        <xf:value>settlement</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:insert context="instance('xprModel')/xpr:description/xpr:categories" origin="instance('xprSupplement')/xpr:categories/xpr:category[@type='settlement']"/>
                        </xf:action>
                        <xf:action ev:event="xforms-deselect">
                            <xf:delete ref="instance('xprModel')/xpr:description/xpr:categories/xpr:category[@type='settlement']"/>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Décrire et évaluer les travaux à venir</xf:label>
                        <xf:value>assessment</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:insert context="instance('xprModel')/xpr:description/xpr:categories" origin="instance('xprSupplement')/xpr:categories/xpr:category[@type='assessment']"/>
                        </xf:action>
                        <xf:action ev:event="xforms-deselect">
                            <xf:delete ref="instance('xprModel')/xpr:description/xpr:categories/xpr:category[@type='assessment']"/>
                        </xf:action>
                    </xf:item>
                    <xf:help>Plusieurs cases peuvent être cochées.</xf:help>
                </xf:select>
                <xf:input bind="designation" incremental="true">
                    <xf:label>Désignation</xf:label>
                </xf:input>
                <xf:select1 bind="designationRubric" appearance="full">
                    <xf:label>En rubrique</xf:label>
                    <xf:item>
                        <xf:label>oui</xf:label>
                        <xf:value>true</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>non</xf:label>
                        <xf:value>false</xf:value>
                    </xf:item>
                </xf:select1>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:categories, 'yes')"/>
                        </pre>
            <xf:group ref="xpr:description/xpr:procedure">
                <xf:label>Procédure et cadre de l’expertise</xf:label>
                <xf:group ref="xpr:framework">
                    <xf:select1 bind="frameworkType" appearance="full">
                        <!--@quest je ne suis pas certain qu'il y a besoin de détailler autant ? (juste besoin de A-B1-B2A-B2B-C)-->
                        <!--@todo ajouter un output pour le texte de framework-->
                        <!--@rmq voir si on peut passer par un petit modèle de raisonnement pour garder la logique B-B2-B2a-->
                        <!--@todo à défaut, mettre un message d'alerte si B ou B2 sont cochés-->
                        <xf:label>Procédure</xf:label>
                        <xf:item>
                            <xf:label>A/ Commun accord des parties</xf:label>
                            <xf:value>a</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:setvalue ref="parent::xpr:framework">Commun accord des parties</xf:setvalue>
                            </xf:action>
                        </xf:item>
                        <xf:choices>
                            <xf:label>B/ Saisie du lieutenant civil (ou autre, à préciser)</xf:label>
                            <xf:item>
                                <xf:label>B1/ Requête auprès du LC pour qu’il demande une expertise</xf:label>
                                <xf:value>b1</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:framework">Requête auprès du lieutenant civil pour qu’il demande une expertise</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:choices>
                        <xf:choices>
                            <xf:label>B2/ Le LC est saisi dans le cadre d’une procédure</xf:label>
                            <xf:item>
                                <xf:label>B2a/ LC saisi dans le cadre d’une procédure (Les parties nomment chacune leur expert ou un expert commun)</xf:label>
                                <xf:value>b2a</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:framework">Le lieutenant civil est saisi dans le cadre d’une procédure (les parties nomment chacune leur expert ou un expert en commun)</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>B2b/ LC saisi dans le cadre d’une procédure (Le LC nomme un ou deux experts)</xf:label>
                                <xf:value>b2b</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:framework">Le lieutenant civil est saisi dans le cadre d’une procédure (le lieutenant civil nomme un ou deux experts)</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:choices>
                        <xf:choices>
                            <xf:item>
                                <xf:label>B3/ Saisie mixte (un expert est nommé par les parties, l'autre est nommé d'office)</xf:label>
                                <xf:value>b3</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="parent::xpr:framework">Saisie mixte (un expert est nommé par les parties, l'autre est nommé d'office)</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:choices>
                        <!--@todo comment faire pour préciser si ce n'est pas le LC ?-->
                        <xf:item>
                            <xf:label>C/ Cas problématique</xf:label>
                            <xf:value>c</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:setvalue ref="parent::xpr:framework">Cas problématique</xf:setvalue>
                            </xf:action>
                        </xf:item>
                    </xf:select1>
                </xf:group>
                <xf:group ref="xpr:origination">
                    <xf:label>Origine de l’expertise</xf:label>
                    <xf:select1 bind="originationType">
                        <xf:label>Déclenchement de l’expertise</xf:label>
                        <xf:item>
                            <xf:label>Les parties</xf:label>
                            <xf:value>parties</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:setvalue ref="ancestor::xpr:origination" value="'Les parties'"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Une institution</xf:label>
                            <xf:value>institution</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:setvalue ref="ancestor::xpr:origination" value="'Une institution'"/>
                            </xf:action>
                        </xf:item>
                    </xf:select1>
                </xf:group>
                <xf:group ref="xpr:sentences">
                    <xf:label>Intervention d’une institution</xf:label>
                    <xf:repeat id="repeatSentence" bind="sentence" appearance="full">
                        <xf:input ref="xpr:orgName" incremental="true">
                            <xf:label>Description de l’institution</xf:label>
                        </xf:input>
                        <xf:repeat id="repeatDateSentence" nodeset="xpr:date/@when">
                            <xf:input ref="." incremental="true">
                                <xf:label>Date</xf:label>
                            </xf:input>
                            <xf:trigger class="delete">
                                <xf:label>Supprimer une date</xf:label>
                                <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:procedure/xpr:sentences/xpr:sentence/xpr:date) > 1"/>
                                <xf:help>Supprimer une date.</xf:help>
                            </xf:trigger>
                        </xf:repeat>
                        <xf:trigger class="insert">
                            <xf:label>Ajouter une date</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert nodeset="xpr:date" at="index('repeatDateSentence')" position="after" ev:event="DOMActivate"/>
                                <xf:setvalue ref="xpr:date[index('repeatDateSentence')]/@when" value=""/>
                            </xf:action>
                            <xf:help>Ajouter une date.</xf:help>
                        </xf:trigger>
                        <xf:trigger class="delete">
                            <xf:label>Supprimer une institution</xf:label>
                            <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:procedure/xpr:sentences/xpr:sentence) > 1"/>
                            <xf:help>Supprimer une institution.</xf:help>
                        </xf:trigger>
                    </xf:repeat>
                    <!--@todo si l'on a renseigné une première institution avec plusieurs sentences, lorsqu'on ajoute une institution, le même nombre de sentence est copié => le remettre à 1-->
                    <xf:trigger class="insert">
                        <xf:label>Ajouter une institution</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert nodeset="xpr:sentence" at="index('repeatSentence')" position="after" ev:event="DOMActivate"/>
                            <xf:setvalue ref="xpr:sentence[index('repeatSentence')]/xpr:orgName" value=""/>
                            <xf:setvalue ref="xpr:sentence[index('repeatSentence')]/xpr:date" value=""/>
                        </xf:action>
                        <xf:help>Ajouter une institution.</xf:help>
                    </xf:trigger>
                </xf:group>
                <xf:group ref="xpr:case">
                    <xf:input bind="case" incremental="true">
                        <!--@todo mettre une zone de texte ?-->
                        <xf:label>Cause de l’expertise</xf:label>
                    </xf:input>
                </xf:group>
                <xf:group ref="instance('xprSupplement')/xpr:objects">
                    <xf:select ref="xpr:object" appearance="full">
                        <!--@bug il existe l'attribut selection="open" pour ces cas mais il ne semble pas fonctionner. Il permet de préciser une valeur qui ne serait pas dans la liste.-->
                        <!-- https://sourceforge.net/p/xsltforms/mailman/message/24465876/ -->
                        <xf:label>Objet de l’expertise</xf:label>
                        <xf:item>
                            <xf:label>Maison</xf:label>
                            <xf:value>house</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='house']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='house']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Terrain</xf:label>
                            <xf:value>plot</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='plot']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='plot']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Ensemble de bâtiments</xf:label>
                            <xf:value>buildings</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='buildings']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='buildings']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Domaine, terres, fief</xf:label>
                            <xf:value>territory</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='territory']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='territory']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Mur</xf:label>
                            <xf:value>wall</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='wall']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='wall']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Fosse d’aisance</xf:label>
                            <xf:value>cesspool</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='cesspool']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='cesspool']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Puits</xf:label>
                            <xf:value>well</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='well']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='well']"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>Autre</xf:label>
                            <xf:value>other</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects" origin="instance('xprSupplement')/xpr:objects/xpr:object[@type='other']"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='other']"/>
                            </xf:action>
                        </xf:item>
                    </xf:select>
                    <xf:input ref="instance('xprModel')/xpr:description/xpr:procedure/xpr:objects/xpr:object[@type='other']" incremental="true">
                        <xf:label>Autre, à préciser</xf:label>
                    </xf:input>
                </xf:group>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:procedure, 'yes')"/>
                        </pre>
        </xf:case>
        <xf:case id="participantsPanel" selected="false">
            <xf:label>Acteurs de l’expertise</xf:label>
            <xf:group ref="xpr:description/xpr:participants/xpr:experts">
                <!--@todo au pluriel ?-->
                <xf:label>Expert</xf:label>
                <xf:repeat id="repeatExpert" nodeset="xpr:expert" appearance="full">
                    <xf:select1 ref="@ref" incremental="true">
                        <xf:label>Patronyme</xf:label>
                        <xf:itemset nodeset="instance('xprExperts')/xpr:expert">
                            <xf:label value="concat(xpr:persName/xpr:surname,', ',xpr:persName/xpr:forename, ', ', xpr:provision)"/>
                            <xf:value ref="@xml:id"/>
                            <!--<xf:setvalue ref="instance('xprModel')/description/participants/experts/expert[index('repeatExpert')]/name" value="instance('xprExperts')/expert[@xml:id=./@xml:id]/name/surname" ev:event="xforms-selected"/>-->
                            <!--<xf:action ev:event="xforms-value-changed">
                                        <xf:setvalue ref="instance('xprModel')/description/participants/experts/expert[index('repeatExpert')]/name" value="instance('xprExperts')/expert[@xml:id=instance('xprModel')/description/participants/experts/expert[index('repeatExpert')]/@ref]/name/surname"/>
                                    </xf:action>-->
                        </xf:itemset>
                    </xf:select1>
                    <xf:input ref="xpr:title" incremental="true">
                        <xf:label>Dénomination de l’expert dans l’acte</xf:label>
                    </xf:input>
                    <xf:select1 ref="@context">
                        <xf:label>Expert nommé en</xf:label>
                        <xf:item>
                            <xf:label>premier lieu</xf:label>
                            <xf:value>primary</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>tiers expert</xf:label>
                            <xf:value>third-party</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>indéterminé</xf:label>
                            <xf:value>unknown</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:select1 ref="@appointment">
                        <xf:label>Expert nommé</xf:label>
                        <xf:item>
                            <xf:label>d’office (par le lieutenant civil)</xf:label>
                            <xf:value>court-appointed</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>par les parties</xf:label>
                            <xf:value>appointed</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>indéterminé</xf:label>
                            <xf:value>unknown</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer un expert</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:participants/xpr:experts/xpr:expert) > 1"/>
                        <xf:help>Supprimer un expert.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un expert</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:expert" at="index('repeatExpert')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:expert[index('repeatExpert')]/@ref" value=""/>
                        <xf:setvalue ref="xpr:expert[index('repeatExpert')]/@context" value=""/>
                        <xf:setvalue ref="xpr:expert[index('repeatExpert')]/@appointment" value=""/>
                        <xf:setvalue ref="xpr:expert[index('repeatExpert')]/xpr:title" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un expert.</xf:help>
                </xf:trigger>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:participants/xpr:experts, 'yes')"/>
                        </pre>
            <xf:group ref="xpr:description/xpr:participants/xpr:clerks">
                <!--@todo au pluriel ?-->
                <xf:label>Greffier</xf:label>
                <xf:repeat id="repeatClerk" bind="clerk" appearance="full">
                    <xf:label>Patronyme</xf:label>
                    <xf:input ref="xpr:persName/xpr:surname" incremental="true">
                        <xf:label>Nom</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:persName/xpr:forename" incremental="true">
                        <xf:label>Prénom</xf:label>
                    </xf:input>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer un greffier</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:participants/xpr:clerks/xpr:clerk) > 1"/>
                        <xf:help>Supprimer un greffier.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un greffier</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:clerk" at="index('repeatClerk')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:clerk[index('repeatClerk')]/xpr:persName/xpr:surname" value=""/>
                        <xf:setvalue ref="xpr:clerk[index('repeatClerk')]/xpr:persName/xpr:forename" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un greffier.</xf:help>
                </xf:trigger>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:participants/xpr:clerks, 'yes')"/>
                        </pre>
            <xf:group ref="xpr:description/xpr:participants/xpr:parties">
                <xf:label>Parties</xf:label>
                <xf:repeat id="repeatParty" bind="party" appearance="full">
                    <xf:repeat id="repeatPerson" nodeset="xpr:person" appearance="full">
                        <xf:label>Patronyme</xf:label>
                        <xf:input ref="xpr:persName/xpr:surname" incremental="true">
                            <xf:label>Nom</xf:label>
                        </xf:input>
                        <xf:input ref="xpr:persName/xpr:forename" incremental="true">
                            <xf:label>Prénom</xf:label>
                        </xf:input>
                        <xf:input ref="xpr:occupation" incremental="true">
                            <xf:label>Qualité, profession</xf:label>
                        </xf:input>
                        <xf:trigger class="delete">
                            <xf:label>Supprimer une personne</xf:label>
                            <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:participants/xpr:parties/xpr:party[index('repeatParty')]/xpr:person) > 1"/>
                            <xf:help>Supprimer une personne.</xf:help>
                        </xf:trigger>
                    </xf:repeat>
                    <xf:trigger class="insert">
                        <xf:label>Ajouter une personne</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert nodeset="xpr:person" at="index('repeatPerson')" position="after" ev:event="DOMActivate"/>
                            <xf:setvalue ref="xpr:person[index('repeatPerson')]/xpr:persName/xpr:surname" value=""/>
                            <xf:setvalue ref="xpr:person[index('repeatPerson')]/xpr:persName/xpr:forename" value=""/>
                            <xf:setvalue ref="xpr:person[index('repeatPerson')]/xpr:occupation" value=""/>
                        </xf:action>
                        <xf:help>Ajouter une personne.</xf:help>
                    </xf:trigger>
                    <xf:select1 ref="@role">
                        <xf:label>Partie</xf:label>
                        <xf:item>
                            <xf:label>Requérante</xf:label>
                            <xf:value>petitioner</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Opposante</xf:label>
                            <xf:value>opponent</xf:value>
                        </xf:item>
                    </xf:select1>
                    <!--<xf:range ref="instance('xprRanges')/xpr:range[@type='role'][position() = count(instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party[index('repeatParty')/preceding-sibling::*)]" start="1" end="3" step="1" incremental="true">
                                <xf:label>Partie <xf:output value="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party/@role"/></xf:label>
                                <xf:action ev:event="xforms-value-changed" if=".='1'">
                                    <xf:setvalue ref="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party/@role">petitioner</xf:setvalue>
                                </xf:action>
                                <xf:action ev:event="xforms-value-changed" if=".='2'">
                                    <xf:setvalue ref="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party/@role"/>
                                </xf:action>
                                <xf:action ev:event="xforms-value-changed" if=".='3'">
                                    <xf:setvalue ref="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party/@role">opponent</xf:setvalue>
                                </xf:action>
                            </xf:range>-->
                    <xf:select1 ref="xpr:status">
                        <xf:label>Qualification individuelle</xf:label>
                        <xf:item>
                            <xf:label>Entrepreneur</xf:label>
                            <xf:value>builder</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Propriétaire</xf:label>
                            <xf:value>owner</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Copropriétaire</xf:label>
                            <xf:value>joint-owner</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Commanditaire</xf:label>
                            <xf:value>limited-partner</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Héritier</xf:label>
                            <xf:value>heir</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Voisin</xf:label>
                            <xf:value>neighbour</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Locataire</xf:label>
                            <xf:value>tenant</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Principal locataire</xf:label>
                            <xf:value>main-tenant</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Créancier</xf:label>
                            <xf:value>creditor</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Débiteur</xf:label>
                            <xf:value>mortgagor</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Fermier judiciaire</xf:label>
                            <xf:value>contractor</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:select1 ref="xpr:expert/@ref">
                        <xf:label>Expert agissant pour cette partie</xf:label>
                        <xf:itemset nodeset="instance('xprExperts')/xpr:expert[@xml:id=instance('xprModel')/xpr:description/xpr:participants/xpr:experts/xpr:expert/@ref]">
                            <xf:label value="concat(xpr:persName/xpr:surname,', ',xpr:persName/xpr:forename, ', ', xpr:provision)"/>
                            <xf:value ref="@xml:id"/>
                        </xf:itemset>
                    </xf:select1>
                    <xf:select1 ref="@presence">
                        <xf:label>Partie présente</xf:label>
                        <xf:item>
                            <xf:label>oui</xf:label>
                            <xf:value>true</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>non</xf:label>
                            <xf:value>false</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:select1 ref="@intervention">
                        <xf:label>Partie intervenante</xf:label>
                        <xf:item>
                            <xf:label>oui</xf:label>
                            <xf:value>true</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>non</xf:label>
                            <xf:value>false</xf:value>
                        </xf:item>
                    </xf:select1>
                    <!--<xf:output ref="instance('xprExpert')/expert[@xml:id=instance('xprModel')/description/participants/experts/expert/@ref]/name/surname"/>-->
                    <!--@todo faire un repeat pour les représentants et procureurs ?-->
                    <xf:group>
                        <xf:label>Représentants</xf:label>
                        <xf:repeat id="repeatRepresentative" nodeset="xpr:representative" appearance="full">
                            <xf:label>Patronyme</xf:label>
                            <xf:input ref="xpr:persName/xpr:surname" incremental="true">
                                <xf:label>Nom</xf:label>
                            </xf:input>
                            <xf:input ref="xpr:persName/xpr:forename" incremental="true">
                                <xf:label>Prénom</xf:label>
                            </xf:input>
                            <xf:input ref="xpr:occupation" incremental="true">
                                <xf:label>Qualité, profession</xf:label>
                            </xf:input>
                            <xf:trigger class="delete">
                                <xf:label>Supprimer un représentant</xf:label>
                                <xf:delete nodeset="." at="1" ev:event="DOMActivate"/>
                                <xf:help>Supprimer un représentant.</xf:help>
                            </xf:trigger>
                        </xf:repeat>
                        <!--<xf:trigger class="insert">
                                        <xf:label>Ajouter un représentant</xf:label>
                                        <xf:action ev:event="DOMActivate">
                                            <xf:insert nodeset="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party/xpr:representative" at="index('repeatRepresentative')" position="after" ev:event="DOMActivate"/>
                                            <xf:setvalue ref=".[index('repeatRepresentative')]/xpr:persName/xpr:surname" value=""/>
                                            <xf:setvalue ref=".[index('repeatRepresentative')]/xpr:persName/xpr:forename" value=""/>
                                            <xf:setvalue ref=".[index('repeatRepresentative')]/xpr:occupation" value=""/>
                                        </xf:action>
                                    </xf:trigger>-->
                        <xf:trigger bind="addRepresentative">
                            <xf:label>Ajouter un representant</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert origin="instance('xprSupplement')/xpr:representative" nodeset="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party[index('repeatParty')]/*" at="last()" position="after"/>
                            </xf:action>
                            <xf:help>Ajouter un représentant.</xf:help>
                        </xf:trigger>
                    </xf:group>
                    <xf:group>
                        <xf:label>Procureur</xf:label>
                        <xf:repeat id="repeatProsecutor" nodeset="xpr:prosecutor" appearance="full">
                            <xf:label>Patronyme</xf:label>
                            <xf:input ref="xpr:persName/xpr:surname" incremental="true">
                                <xf:label>Nom</xf:label>
                            </xf:input>
                            <xf:input ref="xpr:persName/xpr:forename" incremental="true">
                                <xf:label>Prénom</xf:label>
                            </xf:input>
                            <xf:trigger class="delete">
                                <xf:label>Supprimer un procureur</xf:label>
                                <xf:delete nodeset="." at="1" ev:event="DOMActivate"/>
                                <xf:help>Supprimer un procureur.</xf:help>
                            </xf:trigger>
                        </xf:repeat>
                        <!--<xf:trigger class="insert">
                                        <xf:label>Ajouter un procureur</xf:label>
                                        <xf:action ev:event="DOMActivate">
                                            <xf:insert nodeset="xpr:prosecutor" at="index('repeatProsecutor')" position="after" ev:event="DOMActivate"/>
                                            <xf:setvalue ref="xpr:prosecutor[index('repeatProsecutor')]/xpr:persName/xpr:surname" value=""/>
                                            <xf:setvalue ref="xpr:prosecutor[index('repeatProsecutor')]/xpr:persName/xpr:forename" value=""/>
                                        </xf:action>
                                    </xf:trigger>-->
                        <xf:trigger bind="addProsecutor">
                            <xf:label>Ajouter un procureur</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert origin="instance('xprSupplement')/xpr:prosecutor" nodeset="instance('xprModel')/xpr:description/xpr:participants/xpr:parties/xpr:party[index('repeatParty')]/*" at="last()" position="after"/>
                            </xf:action>
                            <xf:help>Ajouter un procureur.</xf:help>
                        </xf:trigger>
                    </xf:group>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer une partie</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:participants/xpr:parties/xpr:party) > 1"/>
                        <xf:help>Supprimer une partie.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter une partie</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:party" at="index('repeatParty')" position="after" ev:event="DOMActivate"/>
                        <!--@todo set value-->
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/@role" value=""/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/@presence" value=""/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/@intervention" value=""/>
                        <xf:delete ref="xpr:party[index('repeatParty')]/xpr:person[position() &gt; 1]"/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:person/xpr:persName/xpr:surname" value=""/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:person/xpr:persName/xpr:forename" value=""/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:person/xpr:occupation" value=""/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:status" value=""/>
                        <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:expert/@ref" value=""/>
                        <xf:delete ref="xpr:party[index('repeatParty')]/xpr:representative"/>
                        <xf:delete ref="xpr:party[index('repeatParty')]/xpr:prosecutor"/>
                        <!--<xf:delete ref="xpr:party[index('repeatParty')]/xpr:representative[position() &gt; 1]"/>
                                    <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:representative/xpr:persName/xpr:surname" value=""/>
                                    <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:representative/xpr:persName/xpr:forename" value=""/>
                                    <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:representative/xpr:occupation" value=""/>
                                    <xf:delete ref="xpr:party[index('repeatParty')]/xpr:prosecutor[position() &gt; 1]"/>
                                    <xf:delete ref="xpr:party[index('repeatParty')]/xpr:prosecutor[position() &gt; 1]"/>
                                    <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:prosecutor/xpr:persName/xpr:surname" value=""/>
                                    <xf:setvalue ref="xpr:party[index('repeatParty')]/xpr:prosecutor/xpr:persName/xpr:forename" value=""/>-->
                    </xf:action>
                    <xf:help>Ajouter une partie.</xf:help>
                </xf:trigger>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:participants/xpr:parties, 'yes')"/>
                        </pre>
            <xf:group ref="xpr:description/xpr:participants/xpr:craftmen">
                <!--@quest au pluriel ?-->
                <xf:label>Entrepreneur, architecte ou maître d’œuvre</xf:label>
                <xf:repeat id="repeatCraftman" bind="craftman" appearance="full">
                    <xf:label>Patronyme</xf:label>
                    <xf:input ref="xpr:persName/xpr:surname" incremental="true">
                        <xf:label>Nom</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:persName/xpr:forename" incremental="true">
                        <xf:label>Prénom</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:occupation" incremental="true">
                        <xf:label>profession</xf:label>
                    </xf:input>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer un entrepreneur, architecte ou maître d’œuvre</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:participants/xpr:craftmen/xpr:craftman) > 1"/>
                        <xf:help>Supprimer un entrepreneur, architecte ou maître d’œuvre.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un entrepreneur, architecte ou maître d’œuvre</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:craftman" at="index('repeatCraftman')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:craftman[index('repeatCraftman')]/xpr:persName/xpr:surname" value=""/>
                        <xf:setvalue ref="xpr:craftman[index('repeatCraftman')]/xpr:persName/xpr:forename" value=""/>
                        <xf:setvalue ref="xpr:craftman[index('repeatCraftman')]/xpr:occupation" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un entrepreneur, architecte ou maître d’œuvre.</xf:help>
                </xf:trigger>
            </xf:group>
            <!--control-->
            <pre>
                            <xf:output value="serialize(xpr:description/xpr:participants/xpr:craftmen, 'yes')"/>
                        </pre>
        </xf:case>
        <xf:case id="conclusionsPanel" selected="false">
            <xf:label>Conclusions ou dispositifs de l’expertise</xf:label>
            <xf:group ref="xpr:description/xpr:conclusions">
                <xf:select1 bind="agreement" appearance="full">
                    <xf:item>
                        <xf:label>Accord</xf:label>
                        <xf:value>Accord</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:setvalue bind="agreementType">agreement</xf:setvalue>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Désaccord</xf:label>
                        <xf:value>Désaccord</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:setvalue bind="agreementType">disagreement</xf:setvalue>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Sans conclusion</xf:label>
                        <xf:value>Sans conclusion</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:setvalue bind="agreementType">noConclusion</xf:setvalue>
                        </xf:action>
                    </xf:item>
                </xf:select1>
                <xf:repeat id="repeatOpinion" bind="opinion">
                    <xf:label>Transcription de toutes les conclusions ou dispositifs d’experts</xf:label>
                    <xf:textarea ref="." incremental="true">
                        <xf:label>Conclusions</xf:label>
                    </xf:textarea>
                    <xf:trigger class="delete">
                        <xf:label>Supprimer une conclusion</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:conclusions/xpr:opinion) > 1"/>
                        <xf:help>Supprimer une conclusion.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter une conclusion</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:opinion" at="index('repeatOpinion')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:opinion[index('repeatOpinion')]" value=""/>
                    </xf:action>
                    <xf:help>Ajouter une conclusion.</xf:help>
                </xf:trigger>
                <xf:input bind="estimate" incremental="true">
                    <xf:label>Montant global (pour les estimations)</xf:label>
                </xf:input>
                <xf:group ref="xpr:fees">
                    <xf:label>Coût de l’expertise</xf:label>
                    <xf:select1 bind="feesDetail" appearance="full">
                        <xf:label>Détail</xf:label>
                        <xf:item>
                            <xf:label>oui</xf:label>
                            <xf:value>true</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert context="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees" origin="instance('xprSupplement')/xpr:fees/*[not(@type='other')]"/>
                            </xf:action>
                        </xf:item>
                        <xf:item>
                            <xf:label>non</xf:label>
                            <xf:value>false</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type]"/>
                            </xf:action>
                        </xf:item>
                    </xf:select1>
                    <xf:group ref="xpr:fee[@type='expert']">
                        <xf:label>Expert(s)</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:fee[@type='clerk']">
                        <xf:label>Greffier</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:fee[@type='rolls']">
                        <xf:label>Rôles</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:fee[@type='papers']">
                        <xf:label>Papier et contrôle</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:fee[@type='plans']">
                        <xf:label>Plans</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:fee[@type='prosecutors']">
                        <xf:label>Procureurs</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:fee[@type='help']">
                        <xf:label>Aides</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:repeat id="repeatOtherFee" nodeset="xpr:fee[@type='other']" appearance="full">
                        <xf:label>Autres frais</xf:label>
                        <xf:input ref=".">
                            <xf:label>Intitulé</xf:label>
                        </xf:input>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                        <xf:trigger class="delete">
                            <xf:label>Supprimer ces frais</xf:label>
                            <xf:delete nodeset="." at="1" ev:event="DOMActivate"/>
                            <xf:help>Supprimer ces frais.</xf:help>
                        </xf:trigger>
                    </xf:repeat>
                    <xf:trigger bind="addOtherFee">
                        <xf:label>Ajouter d'autres frais</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert origin="instance('xprSupplement')/xpr:fees/xpr:fee[@type='other']" nodeset="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[position() = last()]" position="after"/>
                            <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]" value=""/>
                            <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]/@l" value=""/>
                            <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]/@s" value=""/>
                            <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]/@d" value=""/>
                        </xf:action>
                        <xf:help>Ajouter d'autres frais.</xf:help>
                    </xf:trigger>
                    <!--<xf:trigger class="insert">
                                    <xf:label>Ajouter d'autres frais</xf:label>
                                    <xf:action ev:event="DOMActivate">
                                        <xf:insert nodeset="xpr:fee[@type='other']" at="index('repeatOtherFee')" position="after" ev:event="DOMActivate"/>
                                        <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]" value=""/>
                                        <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]/@l" value=""/>
                                        <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]/@s" value=""/>
                                        <xf:setvalue ref="xpr:fee[@type='other'][index('repeatOtherFee')]/@d" value=""/>
                                    </xf:action>
                                    <xf:help>Ajouter d'autres frais.</xf:help>
                                </xf:trigger>-->
                    <!--<xf:select ref="instance('xprSupplement')/xpr:fees/xpr:fee" appearance="full">
                                    <xf:item>
                                        <xf:label>Autre</xf:label>
                                        <xf:value>other</xf:value>
                                        <xf:action ev:event="xforms-select">
                                            <xf:insert context="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees" origin="instance('xprSupplement')/xpr:fees/xpr:fee[@type='other']"/>
                                        </xf:action>
                                        <xf:action ev:event="xforms-deselect">
                                            <xf:delete ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type='other']"/>
                                        </xf:action>
                                        
                                        <!-\-
                                            <xf:repeat id="repeatFeeOther" nodeset="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type='other']" appearance="full">
                                            <xf:input ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type='other']"><xf:label>Autre, à préciser</xf:label></xf:input>
                                            <xf:group ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type='other']">
                                                <xf:label>Montant</xf:label>
                                                <xf:input ref="@l" incremental="true"><xf:label>livres</xf:label></xf:input>
                                                <xf:input ref="@s" incremental="true"><xf:label>sols</xf:label></xf:input>
                                                <xf:input ref="@d" incremental="true"><xf:label>deniers</xf:label></xf:input>
                                            </xf:group>
                                            <xf:trigger class="delete">
                                                <xf:label>&#10007;</xf:label>
                                                <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(instance('xprModel')//xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type='other']) > 1"/>
                                                <xf:help>Supprimer</xf:help>
                                            </xf:trigger>
                                        </xf:repeat>
                                        <xf:trigger class="insert">
                                            <xf:label>Ajouter</xf:label>
                                            <xf:action ev:event="DOMActivate">
                                                <xf:insert nodeset="instance('xprModel')/xpr:description/xpr:conclusions/xpr:fees/xpr:fee[@type='other']" at="index('repeatFeeOther')" position="after" ev:event="DOMActivate"/>
                                                <xf:setvalue ref="xpr:fee[@type='other'][index('repeatFeeOther')]" value=""/>
                                                <xf:setvalue ref="xpr:fee[@type='other'][index('repeatFeeOther')]/@l" value=""/>
                                                <xf:setvalue ref="xpr:fee[@type='other'][index('repeatFeeOther')]/@s" value=""/>
                                                <xf:setvalue ref="xpr:fee[@type='other'][index('repeatFeeOther')]/@d" value=""/>
                                            </xf:action>
                                            <xf:help>Ajouter</xf:help>
                                        </xf:trigger>
                                        -\->
                                    </xf:item>
                                </xf:select>-->
                    <xf:group ref="xpr:total">
                        <xf:label>Total</xf:label>
                        <xf:input ref="@l" incremental="true">
                            <xf:label>livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s" incremental="true">
                            <xf:label>sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d" incremental="true">
                            <xf:label>deniers</xf:label>
                        </xf:input>
                    </xf:group>
                </xf:group>
                <xf:group ref="xpr:expenses">
                    <xf:label>Bourse commune</xf:label>
                    <xf:select1 ref="@mentioned">
                        <xf:label>Mention(s) de la bourse commune (des experts ou greffiers) et détail</xf:label>
                        <xf:item>
                            <xf:label>Oui</xf:label>
                            <xf:value>true</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Non</xf:label>
                            <xf:value>false</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses/xpr:expense[@type]"/>
                            </xf:action>
                        </xf:item>
                    </xf:select1>
                    <xf:select ref="instance('xprSupplement')/xpr:expenses/xpr:expense" appearance="full">
                        <xf:item>
                            <xf:label>Bourse commune des experts</xf:label>
                            <xf:value>expert</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert origin="instance('xprSupplement')/xpr:expenses/xpr:expense[@type='expert']" context="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses/xpr:expense[@type='expert']"/>
                            </xf:action>
                            <xf:group ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses/xpr:expense[@type='expert']">
                                <xf:label>Montant</xf:label>
                                <xf:input ref="@l" incremental="true">
                                    <xf:label>livres</xf:label>
                                </xf:input>
                                <xf:input ref="@s" incremental="true">
                                    <xf:label>sols</xf:label>
                                </xf:input>
                                <xf:input ref="@d" incremental="true">
                                    <xf:label>deniers</xf:label>
                                </xf:input>
                            </xf:group>
                        </xf:item>
                        <xf:item>
                            <xf:label>Bourse commune des greffiers</xf:label>
                            <xf:value>clerk</xf:value>
                            <xf:action ev:event="xforms-select">
                                <xf:insert origin="instance('xprSupplement')/xpr:expenses/xpr:expense[@type='clerk']" context="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses"/>
                            </xf:action>
                            <xf:action ev:event="xforms-deselect">
                                <xf:delete ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses/xpr:expense[@type='clerk']"/>
                            </xf:action>
                            <xf:group ref="instance('xprModel')/xpr:description/xpr:conclusions/xpr:expenses/xpr:expense[@type='clerk']">
                                <xf:label>Montant</xf:label>
                                <xf:input ref="@l" incremental="true">
                                    <xf:label>livres</xf:label>
                                </xf:input>
                                <xf:input ref="@s" incremental="true">
                                    <xf:label>sols</xf:label>
                                </xf:input>
                                <xf:input ref="@d" incremental="true">
                                    <xf:label>deniers</xf:label>
                                </xf:input>
                            </xf:group>
                        </xf:item>
                    </xf:select>
                </xf:group>
            </xf:group>
            <!--control-->
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:conclusions, 'yes')"/>
                    </pre>
        </xf:case>
        <xf:case id="keywordsPanel" selected="false">
            <xf:label>Mots-clés et commentaires</xf:label>
            <xf:group ref="xpr:description/xpr:keywords[@type='technical']">
                <xf:label>Rubrique spécifique aux expertises techniques</xf:label>
                <xf:repeat id="repeatTechnicalTerm" bind="technicalTerm" appearance="full">
                    <xf:input ref="." incremental="true">
                        <xf:label>Mot-clé</xf:label>
                    </xf:input>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:keywords[@type='technical']/xpr:term) > 1"/>
                        <xf:help>Supprimer un mot-clé.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un mot-clé</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:term" at="index('repeatTechnicalTerm')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:term[index('repeatTechnicalTerm')]" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un mot-clé.</xf:help>
                </xf:trigger>
            </xf:group>
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:keywords[@type='technical'], 'yes')"/>
                    </pre>
            <xf:group ref="xpr:description/xpr:keywords[@type='tools']">
                <xf:label>Outils et actions de l'expertise</xf:label>
                <xf:repeat id="repeatToolsTerm" bind="toolsTerm" appearance="full">
                    <xf:input ref="." incremental="true">
                        <xf:label>Mot-clé</xf:label>
                    </xf:input>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:keywords[@type='tools']/xpr:term) > 1"/>
                        <xf:help>Supprimer un mot-clé.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un mot-clé</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:term" at="index('repeatToolsTerm')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:term[index('repeatToolsTerm')]" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un mot-clé.</xf:help>
                </xf:trigger>
            </xf:group>
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:keywords[@type='tools'], 'yes')"/>
                    </pre>
            <xf:group ref="xpr:description/xpr:keywords[@type='estimation']">
                <xf:label>Rubrique spécifique aux estimations</xf:label>
                <xf:repeat id="repeatEstimationTerm" bind="estimationTerm" appearance="full">
                    <xf:input ref="." incremental="true">
                        <xf:label>Mot-clé</xf:label>
                    </xf:input>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:keywords[@type='estimation']/xpr:term) > 1"/>
                        <xf:help>Supprimer un mot-clé.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un mot-clé</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:term" at="index('repeatEstimationTerm')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:term[index('repeatEstimationTerm')]" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un mot-clé.</xf:help>
                </xf:trigger>
            </xf:group>
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:keywords[@type='estimation'], 'yes')"/>
                    </pre>
            <xf:group ref="xpr:description/xpr:keywords[@type='law']">
                <xf:label>Rubrique spécifique au droit</xf:label>
                <xf:repeat id="repeatLawTerm" bind="lawTerm" appearance="full">
                    <xf:input ref="." incremental="true">
                        <xf:label>Mot-clé</xf:label>
                    </xf:input>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:description/xpr:keywords[@type='law']/xpr:term) > 1"/>
                        <xf:help>Supprimer un mot-clé.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un mot-clé</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:term" at="index('repeatLawTerm')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:term[index('repeatLawTerm')]" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un mot-clé.</xf:help>
                </xf:trigger>
            </xf:group>
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:keywords[@type='law'], 'yes')"/>
                    </pre>
            <xf:group ref="xpr:description/xpr:analysis">
                <xf:label>Commentaires et première analyse</xf:label>
                <xf:textarea ref=".">
                    <xf:label>Passages intéressants</xf:label>
                </xf:textarea>
            </xf:group>
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:analysis, 'yes')"/>
                    </pre>
            <xf:group ref="xpr:description/xpr:noteworthy">
                <xf:label>Éléments remarquables</xf:label>
                <xf:textarea ref=".">
                    <xf:label/>
                </xf:textarea>
            </xf:group>
            <pre>
                        <xf:output value="serialize(xpr:description/xpr:noteworthy, 'yes')"/>
                    </pre>
            <xf:trigger bind="addComment">
                <xf:label>Ajouter un commentaire sur ce formulaire</xf:label>
                <xf:action ev:event="DOMActivate">
                    <!--<xf:delete nodeset="instance('xprModel')/xpr:sourceDesc/xpr:physDesc/xpr:appendices"/>-->
                    <xf:insert origin="instance('xprSupplement')/xpr:comment" nodeset="instance('xprModel')/*" at="last()" position="after"/>
                    <!--<xf:insert nodeset="instance('xprAppendices')"/>-->
                </xf:action>
                <xf:help>Ajouter un commentaire sur ce formulaire.</xf:help>
            </xf:trigger>
            <xf:group ref="xpr:comment">
                <xf:label>Commentaire sur ce formulaire</xf:label>
                <xf:textarea ref=".">
                    <xf:label/>
                </xf:textarea>
                <xf:trigger class="delete">
                    <xf:label>&#10007;</xf:label>
                    <xf:delete nodeset="." at="1" ev:event="DOMActivate"/>
                    <xf:help>Supprimer le commentaire.</xf:help>
                </xf:trigger>
            </xf:group>
        </xf:case>
    </xf:switch>
    <xf:submit submission="submit">
        <xf:label>Enregistrer</xf:label>
    </xf:submit>
</form>
