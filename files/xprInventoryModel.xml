<xf:model
        id="inventory"
        xmlns:xf="http://www.w3.org/2002/xforms"
        xmlns:ev="http://www.w3.org/2001/xml-events">
        <!--<xf:action ev:event="xforms-ready">
                <xf:action while="//xpr:relation[not(@href = '')]/xpr:relationEntry[. = '']">
                        
                </xf:action>
        </xf:action>-->
        <!--Instance principale-->
        <xf:instance
                id="xprInventory"
                src="/xpr/files/_xprInventoryInstance.xml"/>
        <xf:bind
                id="participantRef"
                nodeset="instance('xprInventory')/eac:relations/eac:cpfRelation/@xlink:href"
                relevant="parent::eac:cpfRelation[not(@localType = 'new')]"/>
        <!-- @rmq bind pour vérouiller la modification -->
        <xf:bind
                nodeset="instance('xprInventory')//xpr:relation[not(@href = '')]//* | instance('xprInventory')//xpr:relation[not(@href = '')]//@*"
                readonly="true()"/>
        <xf:bind
                id="relationHrefOb"
                nodeset="instance('xprInventory')//xpr:relation/@href"/>
        <xf:bind
                id="relationMarriage"
                nodeset="instance('xprInventory')//xpr:relation/@href"/>
        <xf:bind
                nodeset="instance('xprInventory')//*[@owned]/xpr:desc"
                relevant="parent::*/@owned = 'true'"/>
        <xf:bind
                nodeset="instance('xprEntities')/xpr:entity[@localType = 'new'][@db = ''][eac:eac-cpf][@xml:id = instance('xprInventory')//eac:cpfRelation/@xlink:href]/eac:eac-cpf/eac:cpfDescription/eac:identity/eac:entityType"
                required="true()"/>
        <xf:instance
                id="xprInventoryCopy"
                src="/xpr/files/_xprInventoryInstance.xml"/>
        <xf:submission
                mode="synchronous"
                id="submitInventory"
                resource="/xpr/inventories/put"
                method="put"
                replace="none">
                <xf:action ev:event="xforms-submit">
                        <xf:setvalue 
                                ref="instance('xprInventory')//eac:relations/eac:cpfRelation/xpr:source/@xlink:href"
                                value="instance('xprInventory')/xpr:sourceDesc/xpr:idno/@unitid"/>
                </xf:action>
                <xf:action
                        ev:event="xforms-submit-done">
                        <xf:message
                                level="modal"> La ressource a été enregistrée ! Status : <xf:output
                                        value="event('response-status-code')"/>; URI : <xf:output
                                        value="event('resource-uri')"/>; Headers : <xf:output
                                        value="event('response-headers')"/>; Reason : <xf:output
                                        value="event('response-reason-phrase')"/>; Body : <xf:output
                                        value="event('response-body')"/>. </xf:message>
                        <xf:send
                                submission="submitRelations"/>
                </xf:action>
                <xf:action
                        ev:event="xforms-submit-error">
                        <xf:message
                                level="modal"> Une erreur est apparue : <xf:output
                                        value="event('error-type')"/>; Status : <xf:output
                                        value="event('response-status-code')"/>; URI : <xf:output
                                        value="event('resource-uri')"/>; Headers : <xf:output
                                        value="event('response-headers')"/>; Reason : <xf:output
                                        value="event('response-reason-phrase')"/> Body : <xf:output
                                        value="event('response-body')"/>. </xf:message>
                </xf:action>
        </xf:submission>
        <xf:submission
                mode="synchronous"
                id="submitRelations"
                resource="/xpr/relations/put"
                method="put"
                replace="none">
                <xf:action
                        ev:event="xforms-submit-done">
                        <xf:message
                                level="modal"> La ressource a été enregistrée ! Status : <xf:output
                                        value="event('response-status-code')"/>; URI : <xf:output
                                        value="event('resource-uri')"/>; Headers : <xf:output
                                        value="event('response-headers')"/>; Reason : <xf:output
                                        value="event('response-reason-phrase')"/>; Body : <xf:output
                                        value="event('response-body')"/>. </xf:message>
                </xf:action>
                <xf:action
                        ev:event="xforms-submit-error">
                        <xf:message
                                level="modal"> Une erreur est apparue : <xf:output
                                        value="event('error-type')"/>; Status : <xf:output
                                        value="event('response-status-code')"/>; URI : <xf:output
                                        value="event('resource-uri')"/>; Headers : <xf:output
                                        value="event('response-headers')"/>; Reason : <xf:output
                                        value="event('response-reason-phrase')"/> Body : <xf:output
                                        value="event('response-body')"/>. </xf:message>
                </xf:action>
        </xf:submission>
</xf:model>
