<?xml version="1.0" encoding="UTF-8"?>
<xf:model
    id="prosopo"
    xmlns:xf="http://www.w3.org/2002/xforms"
    xmlns:ev="http://www.w3.org/2001/xml-events">
    <!-- xprProsopo -->
    <xf:action
        ev:event="xforms-ready">
        <xf:action
            while="instance('xprProsopo')//eac:date[not(@standardDate)]
            | instance('xprProsopo')//eac:fromDate[not(@standardDate)]
            | instance('xprProsopo')//eac:toDate[not(@standardDate)]"
            ev:event="xforms-ready">
            <xf:insert
                context="instance('xprProsopo')//eac:date[not(@standardDate)]
                | instance('xprProsopo')//eac:fromDate[not(@standardDate)]
                | instance('xprProsopo')//eac:toDate[not(@standardDate)]"
                origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@standardDate"/>
        </xf:action>
        <xf:action
            while="instance('xprProsopo')//eac:date[not(@notAfter)]
            | instance('xprProsopo')//eac:fromDate[not(@notAfter)]
            | instance('xprProsopo')//eac:toDate[not(@notAfter)]"
            ev:event="xforms-ready">
            <xf:insert
                context="instance('xprProsopo')//eac:date[not(@notAfter)]
                | instance('xprProsopo')//eac:fromDate[not(@notAfter)]
                | instance('xprProsopo')//eac:toDate[not(@notAfter)]"
                origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@notAfter"/>
        </xf:action>
        <xf:action
            while="instance('xprProsopo')//eac:date[not(@notBefore)]
            | instance('xprProsopo')//eac:fromDate[not(@notBefore)]
            | instance('xprProsopo')//eac:toDate[not(@notBefore)]"
            ev:event="xforms-ready">
            <xf:insert
                context="instance('xprProsopo')//eac:date[not(@notBefore)]
                | instance('xprProsopo')//eac:fromDate[not(@notBefore)]
                | instance('xprProsopo')//eac:toDate[not(@notBefore)]"
                origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@notBefore"/>
        </xf:action>
        <xf:action
            if="instance('xprProsopo')//eac:identity[eac:entityType = '']/eac:nameEntry[eac:alternativeForm]">
            <xf:delete
                ref="instance('xprProsopo')//eac:identity[eac:entityType = '']//eac:nameEntry[eac:alternativeForm]"/>
        </xf:action>
    </xf:action>
    <!-- xprProsopo main instance-->
    <xf:instance
        id="xprProsopo"
        src="/xpr/files/_xprProsopoInstance.xml"/>
    <xf:bind
        id="identity"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:identity/@localType"
        required="true()"/>
    <xf:bind
        id="entityType"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:identity/eac:entityType"
        required="true()"/>
    <xf:bind
        id="vedette"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:identity/eac:nameEntry[./eac:authorizedForm]/eac:part"/>
    <xf:bind
        nodeset="instance('xprProsopo')//eac:biogHist//eac:entityType"
        required="true()"/>
    <xf:bind
        nodeset="instance('xprProsopo')//eac:biogHist//eac:entityType"
        required="true()"/>
    <xf:bind
        nodeset="instance('xprProsopo')//eac:biogHist//eac:identity/@localType"
        required="true()"/>
    <xf:bind
        nodeset="instance('xprProsopo')//eac:biogHist//eac:identity/eac:nameEntry[./eac:authorizedForm]/eac:part"
        required="true()"/>
    <!--<xf:bind nodeset="instance('xprProsopo')/eac:cpfDescription/eac:identity/eac:nameEntry[./eac:authorizedForm]/eac:part" required="true()"/>-->
    <xf:bind
        id="nameEntry"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:identity/eac:nameEntry[./eac:alternativeForm]"/>
    <xf:bind
        id="chronItem"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem"/>
    <xf:bind
        id="chronItemType"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/@localType"/>
    <xf:bind
        id="chronItemDate"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/eac:date"/>
    <xf:bind
        id="chronItemPlace"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/eac:placeEntry"/>
    <xf:bind
        id="chronItemEvent"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/eac:event"/>
    <xf:bind
        id="chronItemParticipant"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/rico:participant"/>
    <!-- @todo vérifier que le relevant est opérationnel pour participantRef et participantDesc (voir bug ci-dessous avec sourceRef -->
    <xf:bind
        id="participantRef"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/rico:participant/@xlink:href"
        relevant="parent::rico:participant[not(@localType = 'new')]"/>
    <xf:bind
        id="involveRef"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/rico:involve/@xlink:href"
        relevant="parent::rico:involve[not(@localType = 'new')]"/>
    <xf:bind
        id="relationRef"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:relations/eac:cpfRelation/@xlink:href"
        relevant="parent::eac:cpfRelation[not(@localType = 'new')]"/>
    <xf:bind
        id="chronItemInvolve"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/rico:involve"/>
    <xf:bind
        id="chronItemSource"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/xpr:source"/>
    <!-- @bug avec le relevant pour sourceRef => géré directement dans le formulaire-->
    <!--<xf:bind
        id="sourceRef"
        nodeset="instance('xprProsopo')//xpr:source/@xlink:href"
        relevant="ancestor::xpr:source[not(@localType = 'new')]"/>-->
    <xf:bind
        id="controlSource"
        nodeset="instance('xprProsopo')/eac:control/eac:sources/eac:source/@xlink:href[not(. = '')][. = instance('xprProsopo')/eac:cpfDescription//xpr:source/@xlink:href or . = instance('xprSources')/xpr:source[@xml:id = instance('xprProsopo')/eac:cpfDescription//xpr:source/@xlink:href]]"
        readonly="true()"/>
    <xf:bind
        id="sourceLocalId"
        nodeset="instance('xprProsopo')//xpr:source/@localId"
        relevant="parent::xpr:source[@localType = 'new']"/>
    <!-- @todo vérifier que #participant est bien utilisé -->
    <xf:bind
        id="participant"
        nodeset="instance('xprProsopo')/eac:cpfDescription/eac:description/eac:biogHist/eac:chronList/eac:chronItem/rico:participant/@xlink:href"/>
    <!-- xprProsopoCopy for repeated sections in the main form (avoid setvalue when repeating a section)-->
    <xf:instance
        id="xprProsopoCopy"
        src="/xpr/files/_xprProsopoInstance.xml"/>
    <!-- xprNewEntity for new participant/involve submission -->
    <xf:instance
        id="xprNewEntity"
        src="/xpr/files/_xprProsopoInstance.xml"/>
    <!-- xprEntities list entities (served by Basex)-->
    <xf:instance
        id="xprEntities"
        src="/xpr/entities"/>
    <xf:bind
        id="obsListEntity"
        nodeset="instance('xprEntities')"/>
    <!-- to update item list in itemset  -->
    <xf:action
        ev:event="xforms-value-changed"
        ev:observer="obsListEntity">
        <xf:refresh
            ev:event="DOMActivate"
            model="source"/>
        <xf:refresh
            ev:event="DOMActivate"
            model="prosopo"/>
    </xf:action>
    <xf:instance
        id="xprSupplement"
        src="/xpr/files/_xprSupplement.xml"/>
    <!-- xprIdentities for entities label (vedette) -->
    <xf:instance
        id="xprIdentities">
        <xpr
            xmlns="xpr"
            xmlns:eac="eac">
            <eac:identity/>
        </xpr>
    </xf:instance>
    <!-- xprStorage to update itemset list -->
    <xf:instance
        id="xprStorage">
        <xpr
            xmlns="xpr"/>
    </xf:instance>
    <xf:instance
        id="xprEntitiesTypes">
        <EntitiesSubTypes
            xmlns="">
            <identity
                type="person">
                <label>Expert (parisien)</label>
                <value>expert</value>
            </identity>
            <identity
                type="person">
                <label>Maçon</label>
                <value>mason</value>
            </identity>
            <identity
                type="person">
                <label>Autre</label>
                <value>person</value>
            </identity>
            <identity
                type="corporateBody">
                <label>Office</label>
                <value>office</value>
            </identity>
            <identity
                type="corporateBody">
                <label>Autre</label>
                <value>org</value>
            </identity>
            <identity
                type="family">
                <label>famille</label>
                <value>family</value>
            </identity>
        </EntitiesSubTypes>
    </xf:instance>
    <xf:instance
        id="xprPlaceTypes">
        <places
            xmlns="">
            <type>
                <label>Naissance</label>
                <value>birthPlace</value>
            </type>
            <type>
                <label>Décès</label>
                <value>deathPlace</value>
            </type>
            <type>
                <label>Résidence</label>
                <value>residence</value>
            </type>
        </places>
    </xf:instance>
    <xf:instance
        id="xprRelationsTypes">
        <relations
            xmlns="">
            <type>
                <label>Maritale</label>
                <value>rico:spouseRelationConnects</value>
            </type>
            <type>
                <label>Fratrie</label>
                <value>rico:siblingRelationConnects</value>
            </type>
            <type>
                <label>Parentale</label>
                <value>rico:childRelationsHasSource</value>
            </type>
            <type>
                <label>Enfant</label>
                <value>rico:childRelationsHasTarget</value>
            </type>
            <type>
                <label>Ascendance</label>
                <value>rico:descendanceRelationHasSource</value>
            </type>
            <type>
                <label>Descendance</label>
                <value>rico:descendanceRelationHaseTarget</value>
            </type>
        </relations>
    </xf:instance>
    <xf:instance
        id="xprEvents">
        <event
            xmlns="">
            <type>
                <label>Naissance</label>
                <value>birth</value>
            </type>
            <type>
                <label>Mariage</label>
                <value>marriage</value>
            </type>
            <type>
                <label>Maîtrise</label>
                <value>master</value>
            </type>
            <type>
                <label>Achat d'office</label>
                <value>officePurchase</value>
            </type>
            <type>
                <label>Provision d'office</label>
                <value>provision</value>
            </type>
            <type>
                <label>Réception</label>
                <value>reception</value>
            </type>
            <type>
                <label>Présence dans les Almanachs</label>
                <value>almanacs</value>
            </type>
            <type>
                <label>Honorariat</label>
                <value>honorary</value>
            </type>
            <type>
                <label>Résignation</label>
                <value>relinquishment</value>
            </type>
            <type>
                <label>Vente d'office</label>
                <value>officeSale</value>
            </type>
            <type>
                <label>Suppression des offices</label>
                <value>officesEnding</value>
            </type>
            <type>
                <label>Dispense d'age</label>
                <value>exemption</value>
            </type>
            <type>
                <label>Sentence d'interdiction</label>
                <value>barringFromOffice</value>
            </type>
            <type>
                <label>Faillite</label>
                <value>bankruptcy</value>
            </type>
            <type>
                <label>Saisie réelle</label>
                <value>seizure</value>
            </type>
            <type>
                <label>Décès</label>
                <value>death</value>
            </type>
        </event>
    </xf:instance>
    <xf:submission
        mode="synchronous"
        id="submitBio"
        resource="/xpr/biographies/put"
        method="put"
        replace="none">
        <xf:action
            ev:event="xforms-submit">
            <xf:delete
                nodeset="instance('xprProsopo')//@standardDate[. = '']"/>
            <xf:delete
                nodeset="instance('xprProsopo')//@notBefore[. = '']"/>
            <xf:delete
                nodeset="instance('xprProsopo')//@notAfter[. = '']"/>
            <xf:delete
                ref="instance('xprProsopo')//*[@localType = 'new']/@localType"/>
        </xf:action>
        <xf:action
            ev:event="xforms-submit"
            if="instance('xprProsopo')//eac:nameEntry[child::eac:authorizedForm]/eac:part[. = '']">
            <xf:setvalue
                ref="instance('xprProsopo')//eac:nameEntry[child::eac:authorizedForm]/eac:part[. = '']"
                value="concat(
                                if(instance('xprProsopo')//eac:entityType[. = 'person'], concat(instance('xprProsopo')//eac:nameEntry[child::eac:alternativeForm][position() = 1]/eac:part[@localType='surname'], ', ', instance('xprProsopo')//eac:nameEntry[child::eac:alternativeForm][position() = 1]/eac:part[@localType='forename'], ' (', if(instance('xprProsopo')//eac:existDates//eac:fromDate/@*[not(. = '')], substring(instance('xprProsopo')//eac:existDates//eac:fromDate/@*[not(. = '')], 1, 4), '?'), ' - ', if(instance('xprProsopo')//eac:existDates//eac:toDate/@*[not(. = '')], substring(instance('xprProsopo')//eac:existDates//eac:toDate/@*[not(. = '')], 1, 4), '?'), ')'), ''),
                                if(instance('xprProsopo')//eac:entityType[. = 'corporateBody'], concat(instance('xprProsopo')//eac:nameEntry[child::eac:alternativeForm][position() = 1]/eac:part[@localType='officeName'], ''), ''),
                                if(instance('xprProsopo')//eac:entityType[. = 'family'], concat(instance('xprProsopo')//eac:nameEntry[child::eac:alternativeForm][position() = 1]/eac:part[@localType='surname'], ''), '')
                                )"/>
        </xf:action>
        <xf:action
            ev:event="xforms-submit"
            if="instance('xprProsopo')/eac:cpfDescription/eac:relations/eac:cpfRelation[@xlink:href = ''][eac:relationEntry = '']">
            <xf:delete
                ref="instance('xprProsopo')/eac:cpfDescription/eac:relations//eac:cpfRelation[@xlink:href = ''][eac:relationEntry = '']"/>
        </xf:action>
        <xf:action
            ev:event="xforms-submit"
            while="instance('xprProsopo')//xpr:source/@xlink:href[not(. = '')][not(. = instance('xprProsopo')//eac:control//eac:source/@xlink:href)]">
            <xf:insert
                context="instance('xprProsopo')/eac:control/eac:sources"
                origin="instance('xprProsopoCopy')/eac:control/eac:sources/eac:source"
                nodeset="./*[last()]"
                position="after"/>
            <xf:setvalue
                ref="instance('xprProsopo')//eac:sources/eac:source/@xlink:href[. = '']"
                value="instance('xprProsopo')//xpr:source/@xlink:href[not(. = instance('xprProsopo')//eac:control//eac:source/@xlink:href)]"/>
            <xf:setvalue
                ref="instance('xprProsopo')//eac:sources/eac:source/eac:sourceEntry[. = '']"
                value="ancestor::eac:source/@xlink:href"/>
        </xf:action>
        <xf:action
            ev:event="xforms-submit-done">
            <xf:message
                level="modal">
                Body : 
                <xf:output
                    value="event('response-body')"/> ;
                Status : <xf:output
                    value="event('response-status-code')"/>;
                URI :
                <xf:output
                    value="event('resource-uri')"/>;
                Headers :
                <xf:output
                    value="event('response-headers')"/>;
                Reason :
                <xf:output
                    value="event('response-reason-phrase')"/>.
            </xf:message>
            <xf:load
                show="replace">
                <xf:resource
                    value="'/xpr/biographies/new'"/>
            </xf:load>
        </xf:action>
        <xf:action
            ev:event="xforms-submit-error">
            <xf:message>Votre formulaire n’a pas pu être enregistré, merci de corriger les erreurs</xf:message>
            <xf:action
                while="instance('xprProsopo')//eac:date[not(@standardDate)]
                | instance('xprProsopo')//eac:fromDate[not(@standardDate)]
                | instance('xprProsopo')//eac:toDate[not(@standardDate)]"
                ev:event="xforms-submit-error">
                <xf:insert
                    context="instance('xprProsopo')//eac:date[not(@standardDate)]
                    | instance('xprProsopo')//eac:fromDate[not(@standardDate)]
                    | instance('xprProsopo')//eac:toDate[not(@standardDate)]"
                    origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@standardDate"/>
            </xf:action>
            <xf:action
                while="instance('xprProsopo')//eac:date[not(@notAfter)]
                | instance('xprProsopo')//eac:fromDate[not(@notAfter)]
                | instance('xprProsopo')//eac:toDate[not(@notAfter)]"
                ev:event="xforms-submit-error-ready">
                <xf:insert
                    context="instance('xprProsopo')//eac:date[not(@notAfter)]
                    | instance('xprProsopo')//eac:fromDate[not(@notAfter)]
                    | instance('xprProsopo')//eac:toDate[not(@notAfter)]"
                    origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@notAfter"/>
            </xf:action>
            <xf:action
                while="instance('xprProsopo')//eac:date[not(@notBefore)]
                | instance('xprProsopo')//eac:fromDate[not(@notBefore)]
                | instance('xprProsopo')//eac:toDate[not(@notBefore)]"
                ev:event="xforms-submit-error">
                <xf:insert
                    context="instance('xprProsopo')//eac:date[not(@notBefore)]
                    | instance('xprProsopo')//eac:fromDate[not(@notBefore)]
                    | instance('xprProsopo')//eac:toDate[not(@notBefore)]"
                    origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@notBefore"/>
            </xf:action>
        </xf:action>
    </xf:submission>
    <xf:submission
        mode="synchronous"
        id="submitNewEntity"
        ref="instance('xprNewEntity')"
        resource="/xpr/biographies/put"
        method="put"
        replace="none">
        <xf:action
            ev:event="xforms-submit">
            <xf:insert
                context="instance('xprNewEntity')"
                origin="instance('xprEntities')/xpr:entity[@localType = 'new'][@db = ''][eac:eac-cpf][@xml:id = instance('xprProsopo')//*/@xlink:href][1]/eac:eac-cpf"
                nodeset="."
                if="not(instance('xprInventory'))"
                ev:event="DOMActivate"/>
            <xf:insert
                context="instance('xprNewEntity')"
                origin="instance('xprEntities')/xpr:entity[@localType = 'new'][@db = ''][eac:eac-cpf][@xml:id = instance('xprInventory')//*/@xlink:href][1]/eac:eac-cpf"
                nodeset="."
                if="instance('xprInventory')"
                ev:event="DOMActivate"/>
            <!-- source -->
            <xf:setvalue 
                ref="instance('xprNewEntity')//eac:places/eac:place/eac:dateSet/eac:date/xpr:source/@xlink:href
                | instance('xprNewEntity')/eac:cpfDescription/eac:identity/eac:nameEntry[eac:alternativeForm]/xpr:source/@xlink:href" 
                value="instance('xprInventory')/xpr:sourceDesc/xpr:idno/@unitid"
                if="instance('xprInventory')"/>
            <!-- date -->
            <xf:setvalue 
                ref="instance('xprNewEntity')//eac:places/eac:place/eac:dateSet/eac:date/@standardDate" 
                value="instance('xprInventory')/xpr:sourceDesc/xpr:date/@standardDate"
                if="instance('xprInventory')"/>
            <xf:delete
                nodeset="instance('xprNewEntity')//@standardDate[. = '']"/>
            <xf:delete
                nodeset="instance('xprNewEntity')//@notBefore[. = '']"/>
            <xf:delete
                nodeset="instance('xprNewEntity')//@notAfter[. = '']"/>
            <xf:delete
                nodeset="instance('xprNewEntity')//eac:cpfRelation[@xlink:href = ''][eac:relationEntry = '']"/>
        </xf:action>
        <xf:action
            ev:event="xforms-submit-done">
            <xf:message
                level="modal"> La ressource a été enregistrée ! Status : <xf:output
                    value="event('response-status-code')"/>; URI : <xf:output
                    value="event('resource-uri')"/>; Headers : <xf:output
                    value="event('response-headers')"/>; Reason : <xf:output
                    value="event('response-reason-phrase')"/>; Body : <xf:output
                    value="event('response-body')"/>. </xf:message>
            <xf:setvalue
                ref="instance('xprEntities')/xpr:entity[@xml:id = instance('xprNewEntity')//eac:entityId]/@db"
                value="event('response-body')//*:id"/>
            <xf:setvalue
                ref="instance('xprEntities')/xpr:entity[@xml:id = instance('xprNewEntity')//eac:entityId]/@localType"
                value="'stored'"/>
            <xf:setvalue
                ref="instance('xprProsopo')//*[@xlink:href = instance('xprEntities')/xpr:entity[@db = event('response-body')//*:id]/@xml:id]/@xlink:href"
                value="event('response-body')//*:id"
                if="not(instance('xprInventory'))"/>
            <xf:delete
                nodeset="instance('xprProsopo')//*[@xlink:href = event('response-body')//*:id]/@localType[. = 'new']"
                if="not(instance('xprInventory'))"/>
            <xf:setvalue
                ref="instance('xprInventory')//*[@xlink:href = instance('xprEntities')/xpr:entity[@db = event('response-body')//*:id]/@xml:id]/@xlink:href"
                value="event('response-body')//*:id"
                if="instance('xprInventory')"/>
            <xf:delete
                nodeset="instance('xprInventory')//*[@xlink:href = event('response-body')//*:id]/@localType[. = 'new']"
                if="instance('xprInventory')"/>
        </xf:action>
        <xf:action
            ev:event="xforms-submit-error">
            <xf:message
                level="modal">erreur</xf:message>
            <xf:action
                while="instance('xprNewEntity')//eac:date[not(@standardDate)] 
                | instance('xprNewEntity')//eac:fromDate[not(@standardDate)] 
                | instance('xprNewEntity')//eac:toDate[not(@standardDate)]"
                ev:event="xforms-submit-error">
                <xf:insert
                    context="instance('xprNewEntity')//eac:date[not(@standardDate)] 
                    | instance('xprNewEntity')//eac:fromDate[not(@standardDate)] 
                    | instance('xprNewEntity')//eac:toDate[not(@standardDate)]"
                    origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@standardDate"/>
            </xf:action>
            <xf:action
                while="instance('xprNewEntity')//eac:date[not(@notAfter)]
                | instance('xprNewEntity')//eac:fromDate[not(@notAfter)]
                | instance('xprNewEntity')//eac:toDate[not(@notAfter)]"
                ev:event="xforms-submit-error-ready">
                <xf:insert
                    context="instance('xprNewEntity')//eac:date[not(@notAfter)]
                    | instance('xprNewEntity')//eac:fromDate[not(@notAfter)]
                    | instance('xprNewEntity')//eac:toDate[not(@notAfter)]"
                    origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@notAfter"/>
            </xf:action>
            <xf:action
                while="instance('xprNewEntity')//eac:date[not(@notBefore)]
                | instance('xprNewEntity')//eac:fromDate[not(@notBefore)]
                | instance('xprNewEntity')//eac:toDate[not(@notBefore)]"
                ev:event="xforms-submit-error">
                <xf:insert
                    context="instance('xprNewEntity')//eac:date[not(@notBefore)]
                    | instance('xprNewEntity')//eac:fromDate[not(@notBefore)]
                    | instance('xprNewEntity')//eac:toDate[not(@notBefore)]"
                    origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate/@notBefore"/>
            </xf:action>
        </xf:action>
    </xf:submission>
</xf:model>
