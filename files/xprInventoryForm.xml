<form xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
    <xf:group ref="xpr:sourceDesc">
        <xf:input ref="xpr:idno/@unitid" incremental="true">
            <xf:label>Cote</xf:label>
        </xf:input>
        <xf:input ref="xpr:date/@when" incremental="true">
            <xf:label>Date de l'inventaire</xf:label>
        </xf:input>
        <xf:input ref="xpr:location" incremental="true">
            <xf:label>Pages, folios</xf:label>
        </xf:input>
        <xf:select1 ref="xpr:expert/@ref" incremental="true">
            <xf:label>Patronyme</xf:label>
            <xf:itemset nodeset="instance('xprEntities')/*[@type='expert']">
                <xf:label value="."/>
                <xf:value ref="@xml:id"/>
            </xf:itemset>
        </xf:select1>
    </xf:group>
    <xf:group ref="xpr:deathPlace">
        <xf:label>Adresse au moment du décès</xf:label>
        <xf:input ref="xpr:address/xpr:street" incremental="true">
            <xf:label>Voie</xf:label>
        </xf:input>
        <xf:input ref="xpr:address/xpr:buildingNumber" incremental="true">
            <xf:label>Numéro de la voie</xf:label>
        </xf:input>
        <xf:input ref="xpr:complement" incremental="true">
            <xf:label>Précisions géographiques</xf:label>
        </xf:input>
        <xf:input ref="xpr:parish" incremental="true">
            <xf:label>Paroisse</xf:label>
        </xf:input>
        <xf:input ref="xpr:city" incremental="true">
            <xf:label>Ville</xf:label>
        </xf:input>
        <xf:input ref="xpr:district" incremental="true">
            <xf:label>Département</xf:label>
        </xf:input>
        <xf:select1 ref="@type" appearance="full">
            <xf:label>Type de résidence</xf:label>
            <xf:item>
                <xf:label>Résidence principale</xf:label>
                <xf:value>mainHome</xf:value>
            </xf:item>
            <xf:item>
                <xf:label>Autre</xf:label>
                <xf:value>other</xf:value>
            </xf:item>
        </xf:select1>
    </xf:group>
    <xf:group ref="xpr:relations">
        <xf:label>Relations</xf:label>
        <xf:repeat id="repeatRelation" nodeset="xpr:relation">
            <xf:select1 ref="@arcrole" incremental="true">
                <xf:label>Type de relation</xf:label>
                <xf:itemset nodeset="instance('xprRelationsTypes')/type">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                </xf:itemset>
                <xf:action ev:event="xforms-value-changed">
                    <xf:action if=". = 'rico:spouseRelationConnects'">
                        <xf:insert origin="instance('xprSupplement')/eac:biogHist" nodeset="parent::xpr:relation/xpr:occupation"/>
                        <xf:setvalue ref="parent::xpr:relation/eac:biogHist/eac:chronList/eac:chronItem/@localType" value="'marriage'"/>
                        <xf:delete ref="parent::xpr:relation/eac:biogHist/eac:chronList/eac:chronItem/eac:date//@*[not(local-name() = 'standardDate')]"/>
                    </xf:action>
                    <xf:action if="not(. = 'rico:spouseRelationConnects')">
                        <xf:delete ref="parent::xpr:relation/eac:biogHist"/>
                    </xf:action>
                </xf:action>
            </xf:select1>
            <xf:input ref="xpr:relationEntry/eac:nameEntry[eac:authorizedForm]/eac:part">
                <xf:label>Forme contrôlée</xf:label>
            </xf:input>
            <xf:group ref="xpr:relationEntry/eac:nameEntry[eac:alternativeForm]">
                <xf:label>Forme attestée</xf:label>
                <xf:input ref="eac:part[@localType='surname']">
                    <xf:label>Nom</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='forename']">
                    <xf:label>Prénom</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='particle']">
                    <xf:label>Particule</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='common']">
                    <xf:label>Titre d'appel</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='formal']">
                    <xf:label>Titre institutionnel</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='academic']">
                    <xf:label>Titre académique</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='religious']">
                    <xf:label>Titre religieux</xf:label>
                </xf:input>
                <xf:input ref="eac:part[@localType='nobiliary']">
                    <xf:label>Titre de noblesse</xf:label>
                </xf:input>
            </xf:group>
            <xf:select1 ref="xpr:relationEntry/@sex" incremental="true">
                <xf:label>Sexe</xf:label>
                <xf:item>
                    <xf:label>Homme</xf:label>
                    <xf:value>male</xf:value>
                </xf:item>
                <xf:item>
                    <xf:label>Femme</xf:label>
                    <xf:value>female</xf:value>
                </xf:item>
            </xf:select1>
            <xf:select1 ref="xpr:relationEntry/@type">
                <xf:label>Répertoire</xf:label>
                <xf:item>
                    <xf:label>Expert (parisien)</xf:label>
                    <xf:value>expert</xf:value>
                </xf:item>
                <!--<xf:item>
                    <!-\- @todo ?-\->
                    <xf:label>Expert (autre)</xf:label>
                    <xf:value>expertExt</xf:value>
                </xf:item>-->
                <xf:item>
                    <xf:label>Maçon</xf:label>
                    <xf:value>mason</xf:value>
                </xf:item>
                <xf:item>
                    <xf:label>Autre</xf:label>
                    <xf:value>person</xf:value>
                </xf:item>
            </xf:select1>
            <xf:input ref="xpr:occupation">
                <xf:label>Profession</xf:label>
            </xf:input>
            <xf:input ref="xpr:address">
                <xf:label>Adresse</xf:label>
            </xf:input>
            <xf:input ref="eac:biogHist/eac:chronList/eac:chronItem/eac:date/@standardDate">
                <xf:label>Date de mariage</xf:label>
            </xf:input>
            <xf:input ref="eac:existDates/eac:dateRange/eac:toDate/@standardDate">
                <xf:label>Date de décès</xf:label>
            </xf:input>
            <xf:trigger class="delete">
                <xf:label>&#10007;</xf:label>
                <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:relation) > 1 and @href=''"/>
                <xf:help>Supprimer une relation.</xf:help>
            </xf:trigger>
        </xf:repeat>
        <xf:trigger>
            <xf:label>ajouter une relation</xf:label>
            <xf:action ev:event="DOMActivate">
                <xf:insert nodeset="xpr:relation" at="index('repeatRelation')" position="after"/>
                <xf:delete ref="xpr:relation[index('repeatRelation')]//eac:biogHist"/>
                <xf:setvalue ref="xpr:relation[index('repeatRelation')]//* | xpr:relation[index('repeatRelation')]//@*" value=""/>
            </xf:action>
        </xf:trigger>
    </xf:group>
    <xf:group ref="xpr:wealth">
        <xf:label>Fortune</xf:label>
        <xf:select1 ref="xpr:state" incremental="true">
            <xf:label>Propriétaire/locataire</xf:label>
            <xf:item>
                <xf:label>Propriétaire</xf:label>
                <xf:value>propriétaire</xf:value>
                <xf:action ev:event="xforms-select">
                    <xf:setvalue ref="@type">owner</xf:setvalue>
                </xf:action>
            </xf:item>
            <xf:item>
                <xf:label>Locataire</xf:label>
                <xf:value>locataire</xf:value>
                <xf:action ev:event="xforms-select">
                    <xf:setvalue ref="@type">occupant</xf:setvalue>
                </xf:action>
            </xf:item>
        </xf:select1>
        <xf:group ref="xpr:possessions/xpr:movables">
            <xf:label>Biens mobiliers</xf:label>
            <xf:group>
                <xf:label>Somme totale</xf:label>
                <xf:input ref="@l">
                    <xf:label>Livres</xf:label>
                </xf:input>
                <xf:input ref="@s">
                    <xf:label>Sols</xf:label>
                </xf:input>
                <xf:input ref="@d">
                    <xf:label>Deniers</xf:label>
                </xf:input>
            </xf:group>
        </xf:group>
        <xf:group ref="xpr:possessions/xpr:estate">
            <xf:label>Biens immobiliers</xf:label>
            <xf:group ref="xpr:residences">
                <xf:label>Résidences</xf:label>
                <xf:repeat id="repeatResidence" nodeset="xpr:residence">
                    <xf:label>
                        <xf:output value="choose(@type='main', 'Résidence principale', 'Autre résidence')"/>
                    </xf:label>
                    <xf:group ref="xpr:address">
                        <xf:label>Adresse</xf:label>
                        <xf:select1 ref="xpr:place">
                            <xf:label>Localisation</xf:label>
                            <xf:item>
                                <xf:label>Paris</xf:label>
                                <xf:value>Paris</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">Paris</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Banlieue</xf:label>
                                <xf:value>Banlieue</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">suburbs</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Province</xf:label>
                                <xf:value>province</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">province</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:select1>
                        <xf:input ref="xpr:street">
                            <xf:label>Rue</xf:label>
                        </xf:input>
                        <xf:input ref="xpr:buildingNumber">
                            <xf:label>Numéro</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:layout">
                        <xf:label>Liste des pièces</xf:label>
                        <xf:repeat nodeset="xpr:part">
                            <xf:label>
                                <xf:output ref="xpr:label"/>
                            </xf:label>
                            <xf:input ref="@n">
                                <xf:label>Nombre</xf:label>
                            </xf:input>
                        </xf:repeat>
                    </xf:group>
                    <xf:textarea ref="xpr:noteworthy">
                        <xf:label>Éléments remarquables</xf:label>
                    </xf:textarea>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="not(@type = 'main')"/>
                        <xf:help>Supprimer une résidence.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter une résidence</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:residence" at="last()" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:residence[last()]/@type" value="'other'"/>
                        <xf:setvalue ref="xpr:residence[last()]/xpr:address/*" value=""/>
                        <xf:setvalue ref="xpr:residence[last()]/xpr:address/xpr:place/@type" value=""/>
                        <xf:setvalue ref="xpr:residence[last()]/xpr:layout/xpr:part/@n" value=""/>
                        <xf:setvalue ref="xpr:residence[last()]/xpr:layout/xpr:part/xpr:noteworthy" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un bien immobilier.</xf:help>
                </xf:trigger>
            </xf:group>
            <xf:group ref="xpr:workshops">
                <xf:label>Ateliers</xf:label>
                <xf:repeat id="repeatWorkshop" nodeset="xpr:workshop">
                    <xf:label>Atelier</xf:label>
                    <xf:group ref="xpr:address">
                        <xf:label>Adresse</xf:label>
                        <xf:select1 ref="xpr:place">
                            <xf:label>Localisation</xf:label>
                            <xf:item>
                                <xf:label>Paris</xf:label>
                                <xf:value>Paris</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">Paris</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Banlieue</xf:label>
                                <xf:value>Banlieue</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">suburbs</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Province</xf:label>
                                <xf:value>province</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">province</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:select1>
                        <xf:input ref="xpr:street">
                            <xf:label>Rue</xf:label>
                        </xf:input>
                        <xf:input ref="xpr:buildingNumber">
                            <xf:label>Numéro</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:layout">
                        <xf:label>Liste des pièces</xf:label>
                        <xf:repeat nodeset="xpr:part">
                            <xf:label>
                                <xf:output ref="xpr:label"/>
                            </xf:label>
                            <xf:input ref="@n">
                                <xf:label>Nombre</xf:label>
                            </xf:input>
                        </xf:repeat>
                    </xf:group>
                    <xf:textarea ref="xpr:noteworthy">
                        <xf:label>Éléments remarquables</xf:label>
                    </xf:textarea>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if=""/>
                        <xf:help>Supprimer un atelier.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un atelier</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:workshop" at="index('repeatWorkshop')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:workshop[index('repeatWorkshop')]/xpr:address/*" value=""/>
                        <xf:setvalue ref="xpr:workshop[index('repeatWorkshop')]/xpr:address/xpr:place/@type" value=""/>
                        <xf:setvalue ref="xpr:workshop[index('repeatWorkshop')]/xpr:layout/xpr:part/@n" value=""/>
                        <xf:setvalue ref="xpr:workshop[index('repeatWorkshop')]/xpr:layout/xpr:part/xpr:noteworthy" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un bien immobilier.</xf:help>
                </xf:trigger>
            </xf:group>
            <xf:group ref="xpr:buildingSites">
                <xf:label>Chantiers</xf:label>
                <xf:repeat id="repeatBuildingSites" nodeset="xpr:buildingSite">
                    <xf:label>Chantier</xf:label>
                    <xf:group ref="xpr:address">
                        <xf:label>Adresse</xf:label>
                        <xf:select1 ref="xpr:place">
                            <xf:label>Localisation</xf:label>
                            <xf:item>
                                <xf:label>Paris</xf:label>
                                <xf:value>Paris</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">Paris</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Banlieue</xf:label>
                                <xf:value>Banlieue</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">suburbs</xf:setvalue>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>Province</xf:label>
                                <xf:value>province</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="@type">province</xf:setvalue>
                                </xf:action>
                            </xf:item>
                        </xf:select1>
                        <xf:input ref="xpr:street">
                            <xf:label>Rue</xf:label>
                        </xf:input>
                        <xf:input ref="xpr:buildingNumber">
                            <xf:label>Numéro</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:textarea ref="xpr:noteworthy">
                        <xf:label>Éléments remarquables</xf:label>
                    </xf:textarea>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="." at="1" ev:event="DOMActivate" if=""/>
                        <xf:help>Supprimer un atelier.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Ajouter un chantier</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert nodeset="xpr:buildingSite" at="index('repeatBuildingSites')" position="after" ev:event="DOMActivate"/>
                        <xf:setvalue ref="xpr:buildingSite[index('repeatBuildingSites')]/xpr:address/*" value=""/>
                        <xf:setvalue ref="xpr:buildingSite[index('repeatBuildingSites')]/xpr:address/xpr:place/@type" value=""/>
                        <xf:setvalue ref="xpr:buildingSite[index('repeatBuildingSites')]/xpr:layout/xpr:part/xpr:noteworthy" value=""/>
                    </xf:action>
                    <xf:help>Ajouter un chantier.</xf:help>
                </xf:trigger>
            </xf:group>
        </xf:group>
        <xf:group ref="xpr:dowry">
            <xf:label>Dot de la femme</xf:label>
            <xf:group ref=".">
                <xf:label>Argent comptant</xf:label>
                <xf:input ref="@l">
                    <xf:label>Livres</xf:label>
                </xf:input>
                <xf:input ref="@s">
                    <xf:label>Sols</xf:label>
                </xf:input>
                <xf:input ref="@d">
                    <xf:label>Deniers</xf:label>
                </xf:input>
            </xf:group>
            <xf:select1 ref="@privateIncome">
                <xf:label>Rente</xf:label>
                <xf:itemset nodeset="instance('xprSupplement')/xpr:boolean/xpr:state">
                    <xf:label ref="xpr:label"/>
                    <xf:value ref="xpr:value"/>
                </xf:itemset>
            </xf:select1>
            <xf:textarea ref=".">
                <xf:label>Biens en nature</xf:label>
            </xf:textarea>
        </xf:group>
        <xf:input ref="xpr:contribution">
            <xf:label>Apport de l'expert lors du mariage</xf:label>
        </xf:input>
    </xf:group>
    <xf:group ref="xpr:knowledge">
        <xf:label>Savoir - culture</xf:label>
        <xf:group ref="xpr:books">
            <xf:label>Livres</xf:label>
            <xf:input ref="@quantity">
                <xf:label>Quantité</xf:label>
            </xf:input>
            <xf:group ref=".">
                <xf:label>Valeur totale des volumes</xf:label>
                <xf:input ref="@l">
                    <xf:label>Livres</xf:label>
                </xf:input>
                <xf:input ref="@s">
                    <xf:label>Sols</xf:label>
                </xf:input>
                <xf:input ref="@d">
                    <xf:label>Deniers</xf:label>
                </xf:input>
            </xf:group>
            <xf:select1 ref="@bookseller">
                <xf:label>Expert libraire</xf:label>
                <xf:itemset nodeset="instance('xprSupplement')/xpr:boolean/xpr:state">
                    <xf:label ref="xpr:label"/>
                    <xf:value ref="xpr:value"/>
                </xf:itemset>
            </xf:select1>
        </xf:group>
        <xf:group ref="xpr:maps">
            <xf:label>Cartes</xf:label>
            <xf:select1 ref=".">
                <xf:label>Présence de cartes</xf:label>
                <xf:itemset nodeset="instance('xprSupplement')/xpr:boolean/xpr:state">
                    <xf:label ref="xpr:label"/>
                    <xf:value ref="xpr:value"/>
                </xf:itemset>
            </xf:select1>
        </xf:group>
        <xf:group ref="xpr:portraits/xpr:family">
            <xf:label>Portraits de famille</xf:label>
            <xf:input ref="@quantity">
                <xf:label>Quantité</xf:label>
            </xf:input>
        </xf:group>
        <xf:group ref="xpr:portraits/xpr:expert">
            <xf:label>Portraits du défunt</xf:label>
            <xf:input ref="@quantity">
                <xf:label>Quantité</xf:label>
            </xf:input>
        </xf:group>
        <xf:group ref="xpr:drawings">
            <xf:label>Dessins</xf:label>
            <xf:input ref="@quantity">
                <xf:label>Quantité</xf:label>
            </xf:input>
            <xf:textarea ref=".">
                <xf:label>Description</xf:label>
            </xf:textarea>
        </xf:group>
        <xf:group ref="xpr:paintings">
            <xf:label>Peintures</xf:label>
            <xf:input ref="@quantity">
                <xf:label>Quantité</xf:label>
            </xf:input>
            <xf:textarea ref=".">
                <xf:label>Description</xf:label>
            </xf:textarea>
        </xf:group>
    </xf:group>
    <xf:group ref="xpr:tools">
        <xf:label>Instruments</xf:label>
        <xf:group ref="xpr:drawing">
            <xf:label>Instruments à déssiner</xf:label>
            <xf:select1 ref="@owned">
                <xf:itemset nodeset="instance('xprSupplement')/xpr:boolean/xpr:state">
                    <xf:label ref="xpr:label"/>
                    <xf:value ref="xpr:value"/>
                </xf:itemset>
            </xf:select1>
        </xf:group>
        <xf:group ref="xpr:measurement">
            <xf:label>Instruments de mesure</xf:label>
            <xf:textarea ref=".">
                <xf:label>Remarques</xf:label>
            </xf:textarea>
        </xf:group>
        <xf:group ref="xpr:scientific">
            <xf:label>Objets scientifiques</xf:label>
            <xf:repeat nodeset="*[not(self::xpr:noteworthy)]">
                <xf:label>
                    <xf:output ref="."/>
                </xf:label>
                <xf:select1 ref="@owned">
                    <xf:itemset nodeset="instance('xprSupplement')/xpr:boolean/xpr:state">
                        <xf:label ref="xpr:label"/>
                        <xf:value ref="xpr:value"/>
                    </xf:itemset>
                </xf:select1>
            </xf:repeat>
            <xf:textarea ref="xpr:noteworthy">
                <xf:label>Éléments remarquables</xf:label>
            </xf:textarea>
        </xf:group>
        <!--<xf:group ref="xpr:">
            <xf:label></xf:label>
        </xf:group>-->
    </xf:group>
    <xf:group ref="xpr:objects">
        <xf:label>Objets</xf:label>
        <xf:textarea ref="xpr:artistic">
            <xf:label>Objects artistiques</xf:label>
        </xf:textarea>
        <xf:textarea ref="xpr:religious">
            <xf:label>Objects religieux</xf:label>
        </xf:textarea>
    </xf:group>
    <xf:group ref="xpr:buildingWorks">
        <xf:label>Constructions d'édifices</xf:label>
        <xf:repeat id="repeatBuildingWork" nodeset="xpr:work">
            <xf:label>Réalisation (construction)</xf:label>
            <xf:input ref="xpr:client">
                <xf:label>Client</xf:label>
            </xf:input>
            <xf:input ref="xpr:type">
                <xf:label>Type de travaux</xf:label>
            </xf:input>
            <xf:input ref="xpr:date/@when">
                <xf:label>Date</xf:label>
            </xf:input>
            <xf:group ref="xpr:address">
                <xf:label>Adresse</xf:label>
                <xf:input ref="xpr:street">
                    <xf:label>Voie</xf:label>
                </xf:input>
                <xf:input ref="xpr:buildingNumber">
                    <xf:label>Numéro</xf:label>
                </xf:input>
            </xf:group>
            <xf:group ref="xpr:cost">
                <xf:label>Prix</xf:label>
                <xf:input ref="@l">
                    <xf:label>Livres</xf:label>
                </xf:input>
                <xf:input ref="@s">
                    <xf:label>Sols</xf:label>
                </xf:input>
                <xf:input ref="@d">
                    <xf:label>Deniers</xf:label>
                </xf:input>
            </xf:group>
            <xf:trigger class="delete">
                <xf:label>&#10007;</xf:label>
                <xf:delete nodeset="." at="1" ev:event="DOMActivate" if="count(//xpr:work) > 1"/>
                <xf:help>Supprimer une réalisation.</xf:help>
            </xf:trigger>
        </xf:repeat>
        <xf:trigger>
            <xf:label>ajouter une réalisation</xf:label>
            <xf:action ev:event="DOMActivate">
                <xf:insert nodeset="xpr:work" at="last()" position="after"/>
                <xf:setvalue ref="xpr:work[index('repeatBuildingWork')]//*[not(self::xpr:address)] | xpr:work[index('repeatBuildingWork')]//@*" value=""/>
                <buildingWorks>
                    <work>
                        <client/>
                        <type/>
                        <date when=""/>
                        <address>
                            <street/>
                            <buildingNumber/>
                        </address>
                        <cost l="" s="" d=""/>
                    </work>
                </buildingWorks>
            </xf:action>
        </xf:trigger>
        
    </xf:group>
    <xf:group ref="xpr:comments">
        <xf:label>Commentaires libres</xf:label>
        <xf:textarea ref=".">
            <xf:label>Commentaires</xf:label>
            <xf:help>Ce champ permet de signaler les collectionneurs ou les aspects remarquables.</xf:help>
        </xf:textarea>
    </xf:group>
    
    <xf:trigger>
        <xf:label>Enregistrer</xf:label>
        <xf:action ev:event="DOMActivate">
            <xf:action while="instance('xprInventory')//xpr:relation[@href = '']">
                <xf:send submission="submitEntity"/>
            </xf:action>
            <xf:action ev:event="xforms-value-changed" ev:observer="relationHrefOb" if="not(instance('xprInventory')/xpr:relations//xpr:relation[@href = ''])">
                <!-- OK fonctionne avec un bind => testOb-->
                <xf:send submission="submitInventory"/>
            </xf:action>
        </xf:action>
    </xf:trigger>
</form>
