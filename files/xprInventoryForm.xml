<form xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
    <xf:switch>
        <xf:case id="inventoryPanel" selected="true">
            <xf:group ref="xpr:sourceDesc">
                <xf:label>Références</xf:label>
                <xf:input ref="xpr:idno[@type='unitid']" incremental="true">
                    <xf:label>Cote</xf:label>
                </xf:input>
                <xf:input ref="xpr:date/@standardDate" incremental="true">
                    <xf:label>Date de l'inventaire</xf:label>
                    <xf:alert>La date indiquée ne respecte pas le format requis.</xf:alert>
                    <xf:hint>La date indiquée doit respecter les formats suivants : AAAA-MM-JJ ou JJ/MM/AAAA</xf:hint>
                </xf:input>
                <xf:input ref="xpr:location" incremental="true">
                    <xf:label>Pages, folios</xf:label>
                </xf:input>
                <xf:select1 ref="xpr:expert/@ref" incremental="true">
                    <xf:label>Patronyme</xf:label>
                    <xf:itemset model="prosopo"
                                nodeset="instance('xprEntities')/xpr:entity[@type='expert' or @type='altExpert']">
                        <xf:label ref="xpr:label"/>
                        <xf:value value="concat('#', @xml:id)"/>
                        <xf:dispatch ev:event="xforms-select"
                                     name="getData"
                                     targetid="inventory"
                                     delay="1000"/>
                    </xf:itemset>
                </xf:select1>
            </xf:group>
            <!--<xf:trigger>
                <xf:label>get expert</xf:label>
                <xf:send ev:event="DOMActivate" submission="submitGetData"/>
            </xf:trigger>-->
            <xf:group ref="xpr:deathPlace">
                <xf:label>Adresse au moment du décès</xf:label>
                <xf:input ref="xpr:address/xpr:street" incremental="true">
                    <xf:label>Voie</xf:label>
                </xf:input>
                <xf:input ref="xpr:address/xpr:buildingNumber" incremental="true">
                    <xf:label>Numéro de la voie</xf:label>
                </xf:input>
                <xf:input ref="xpr:complement" incremental="true">
                    <xf:label>Précisions géographiques</xf:label>
                </xf:input>
                <xf:input ref="xpr:parish" incremental="true">
                    <xf:label>Paroisse</xf:label>
                </xf:input>
                <xf:input ref="xpr:city" incremental="true">
                    <xf:label>Ville</xf:label>
                </xf:input>
                <xf:input ref="xpr:district" incremental="true">
                    <xf:label>Département</xf:label>
                </xf:input>
                <xf:select1 ref="@type" appearance="full">
                    <xf:label>Type de résidence</xf:label>
                    <xf:item>
                        <xf:label>Résidence principale</xf:label>
                        <xf:value>mainHome</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>Autre</xf:label>
                        <xf:value>other</xf:value>
                    </xf:item>
                </xf:select1>
            </xf:group>
            <xf:group ref="eac:relations">
                <xf:label>Relations</xf:label>
                <xf:repeat id="repeatRelation" nodeset="eac:cpfRelation">
                    <xf:var name="relation" value="."/>
                    <xf:label>Relation</xf:label>
                    <xf:select1 ref="@xlink:href" incremental="true">
                        <xf:itemset model="prosopo" nodeset="instance('xprEntities')/xpr:entity">
                            <xf:label ref="xpr:label"/>
                            <xf:value value="concat('#', @xml:id)"/>
                        </xf:itemset>
                    </xf:select1>
                    <xf:select1 ref="@xlink:arcrole" incremental="true">
                        <xf:label>Type de relation</xf:label>
                        <xf:itemset model="prosopo" nodeset="instance('xprRelationsTypes')/xpr:type">
                            <xf:label ref="xpr:label"/>
                            <xf:value ref="xpr:value"/>
                        </xf:itemset>
                    </xf:select1>
                    <xf:trigger ref="." class="delete">
                        <xf:label>Supprimer une relation</xf:label>
                        <xf:delete nodeset="."
                                   at="1"
                                   if="count(instance('xprProsopo')/eac:cpfDescription/eac:relations/eac:cpfRelation) &gt; 1"
                                   ev:event="DOMActivate"/>
                        <xf:help>Supprimer une relation</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger class="insert">
                    <xf:label>Nouvelle une relation</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert context="."
                                   origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:relations/eac:cpfRelation"
                                   nodeset="eac:cpfRelation"
                                   at="last()"
                                   position="after"
                                   ev:event="DOMActivate"/>
                    </xf:action>
                    <xf:help>Ajouter une relation</xf:help>
                </xf:trigger>
            </xf:group>
            <xf:group ref="xpr:wealth">
                <xf:label>Fortune</xf:label>
                <xf:select1 ref="xpr:state" incremental="true">
                    <xf:label>Propriétaire/locataire</xf:label>
                    <xf:item>
                        <xf:label>Propriétaire</xf:label>
                        <xf:value>propriétaire</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:setvalue ref="@type">owner</xf:setvalue>
                        </xf:action>
                    </xf:item>
                    <xf:item>
                        <xf:label>Locataire</xf:label>
                        <xf:value>locataire</xf:value>
                        <xf:action ev:event="xforms-select">
                            <xf:setvalue ref="@type">occupant</xf:setvalue>
                        </xf:action>
                    </xf:item>
                </xf:select1>
                <xf:group ref="xpr:possessions/xpr:movables">
                    <xf:label>Biens mobiliers</xf:label>
                    <xf:group>
                        <xf:label>Somme totale</xf:label>
                        <xf:input ref="@l">
                            <xf:label>Livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s">
                            <xf:label>Sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d">
                            <xf:label>Deniers</xf:label>
                        </xf:input>
                    </xf:group>
                </xf:group>
                <xf:group ref="xpr:possessions/xpr:estate">
                    <xf:label>Biens immobiliers</xf:label>
                    <xf:group ref="xpr:residences">
                        <xf:label>Résidences</xf:label>
                        <xf:repeat id="repeatResidence"
                                   nodeset="xpr:residence">
                            <xf:label>
                                <xf:output value="choose(@type='main', 'Résidence principale', 'Autre résidence')"/>
                            </xf:label>
                            <xf:group ref="xpr:place">
                                <xf:select1 ref="@type">
                                    <xf:label>Localisation</xf:label>
                                    <xf:item>
                                        <xf:label>Paris</xf:label>
                                        <xf:value>paris</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Banlieue</xf:label>
                                        <xf:value>suburbs</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Province</xf:label>
                                        <xf:value>province</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:input ref="xpr:address/xpr:street">
                                    <xf:label>Rue</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:address/xpr:buildingNumber">
                                    <xf:label>Numéro</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:complement">
                                    <xf:label>Complément</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:parish">
                                    <xf:label>Paroisse</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:city">
                                    <xf:label>Ville</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:district">
                                    <xf:label>Département</xf:label>
                                </xf:input>
                            </xf:group>
                            <xf:group ref="xpr:layout">
                                <xf:label>Liste des pièces</xf:label>
                                <xf:repeat nodeset="xpr:part">
                                    <xf:label>
                                        <xf:output ref="xpr:label"/>
                                    </xf:label>
                                    <xf:input ref="@n">
                                        <xf:label>Nombre</xf:label>
                                    </xf:input>
                                </xf:repeat>
                            </xf:group>
                            <xf:textarea ref="xpr:noteworthy">
                                <xf:label>Éléments remarquables</xf:label>
                            </xf:textarea>
                            <xf:trigger class="delete">
                                <xf:label>&#10007;</xf:label>
                                <xf:delete nodeset="."
                                           at="1"
                                           if="not(@type = 'main')"
                                           ev:event="DOMActivate"/>
                                <xf:help>Supprimer une résidence.</xf:help>
                            </xf:trigger>
                        </xf:repeat>
                        <xf:trigger class="insert">
                            <xf:label>Ajouter une résidence</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="."
                                           origin="instance('xprInventoryCopy')/xpr:wealth/xpr:possessions/xpr:estate/xpr:residences/xpr:residence"
                                           nodeset="xpr:residence[last()]"
                                           position="after"
                                           ev:event="DOMActivate"/>
                                <xf:setvalue ref="xpr:residence[last()]/@type"
                                             value="'other'"/>
                            </xf:action>
                            <xf:help>Ajouter une résidence.</xf:help>
                        </xf:trigger>
                    </xf:group>
                    <xf:group ref="xpr:workshops">
                        <xf:label>Ateliers</xf:label>
                        <xf:repeat id="repeatWorkshop"
                                   nodeset="xpr:workshop">
                            <xf:label>Atelier</xf:label>
                            <xf:group ref="xpr:place">
                                <xf:select1 ref="@type">
                                    <xf:label>Localisation</xf:label>
                                    <xf:item>
                                        <xf:label>Paris</xf:label>
                                        <xf:value>paris</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Banlieue</xf:label>
                                        <xf:value>suburbs</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Province</xf:label>
                                        <xf:value>province</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:input ref="xpr:address/xpr:street">
                                    <xf:label>Rue</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:address/xpr:buildingNumber">
                                    <xf:label>Numéro</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:complement">
                                    <xf:label>Complément</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:parish">
                                    <xf:label>Paroisse</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:city">
                                    <xf:label>Ville</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:district">
                                    <xf:label>Département</xf:label>
                                </xf:input>
                            </xf:group>
                            <xf:group ref="xpr:layout">
                                <xf:label>Liste des pièces</xf:label>
                                <xf:repeat nodeset="xpr:part">
                                    <xf:label>
                                        <xf:output ref="xpr:label"/>
                                    </xf:label>
                                    <xf:input ref="@n">
                                        <xf:label>Nombre</xf:label>
                                    </xf:input>
                                </xf:repeat>
                            </xf:group>
                            <xf:textarea ref="xpr:noteworthy">
                                <xf:label>Éléments remarquables</xf:label>
                            </xf:textarea>
                            <xf:trigger class="delete">
                                <xf:label>&#10007;</xf:label>
                                <xf:delete nodeset="."
                                           at="1"
                                           ev:event="DOMActivate"/>
                                <xf:help>Supprimer un atelier.</xf:help>
                            </xf:trigger>
                        </xf:repeat>
                        <xf:trigger class="insert">
                            <xf:label>Ajouter un atelier</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="."
                                           origin="instance('xprInventoryCopy')/xpr:wealth/xpr:possessions/xpr:estate/xpr:workshops/xpr:workshop"
                                           nodeset="xpr:workshop[last()]"
                                           position="after"
                                           ev:event="DOMActivate"/>
                            </xf:action>
                            <xf:help>Ajouter un atelier.</xf:help>
                        </xf:trigger>
                    </xf:group>
                    <xf:group ref="xpr:buildingSites">
                        <xf:label>Chantiers</xf:label>
                        <xf:repeat id="repeatBuildingSites"
                                   nodeset="xpr:buildingSite">
                            <xf:label>Chantier</xf:label>
                            <xf:group ref="xpr:place">
                                <xf:select1 ref="@type">
                                    <xf:label>Localisation</xf:label>
                                    <xf:item>
                                        <xf:label>Paris</xf:label>
                                        <xf:value>paris</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Banlieue</xf:label>
                                        <xf:value>suburbs</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Province</xf:label>
                                        <xf:value>province</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:input ref="xpr:address/xpr:street">
                                    <xf:label>Rue</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:address/xpr:buildingNumber">
                                    <xf:label>Numéro</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:complement">
                                    <xf:label>Complément</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:parish">
                                    <xf:label>Paroisse</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:city">
                                    <xf:label>Ville</xf:label>
                                </xf:input>
                                <xf:input ref="xpr:district">
                                    <xf:label>Département</xf:label>
                                </xf:input>
                            </xf:group>
                            <xf:textarea ref="xpr:noteworthy">
                                <xf:label>Éléments remarquables</xf:label>
                            </xf:textarea>
                            <xf:trigger class="delete">
                                <xf:label>&#10007;</xf:label>
                                <xf:delete nodeset="."
                                           at="1"
                                           ev:event="DOMActivate"/>
                                <xf:help>Supprimer un atelier.</xf:help>
                            </xf:trigger>
                        </xf:repeat>
                        <xf:trigger class="insert">
                            <xf:label>Ajouter un chantier</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="."
                                           origin="instance('xprInventoryCopy')/xpr:wealth/xpr:possessions/xpr:estate/xpr:buildingSites/xpr:buildingSite"
                                           nodeset="xpr:buildingSite[last()]"
                                           position="after"
                                           ev:event="DOMActivate"/>
                            </xf:action>
                            <xf:help>Ajouter un chantier.</xf:help>
                        </xf:trigger>
                    </xf:group>
                </xf:group>
                <xf:group ref="xpr:dowry">
                    <xf:label>Dot de la femme</xf:label>
                    <xf:group ref=".">
                        <xf:label>Argent comptant</xf:label>
                        <xf:input ref="@l">
                            <xf:label>Livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s">
                            <xf:label>Sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d">
                            <xf:label>Deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:select1 ref="@privateIncome">
                        <xf:label>Rente</xf:label>
                        <xf:itemset nodeset="instance('xprBoolean')/xpr:state">
                            <xf:label ref="xpr:label"/>
                            <xf:value ref="xpr:value"/>
                        </xf:itemset>
                    </xf:select1>
                    <xf:textarea ref=".">
                        <xf:label>Biens en nature</xf:label>
                    </xf:textarea>
                </xf:group>
                <xf:input ref="xpr:contribution">
                    <xf:label>Apport de l'expert lors du mariage</xf:label>
                </xf:input>
            </xf:group>
            <xf:group ref="xpr:knowledge">
                <xf:label>Savoir - culture</xf:label>
                <xf:group ref="xpr:books">
                    <xf:label>Livres</xf:label>
                    <xf:input ref="@quantity">
                        <xf:label>Quantité</xf:label>
                    </xf:input>
                    <xf:group ref=".">
                        <xf:label>Valeur totale des volumes</xf:label>
                        <xf:input ref="@l">
                            <xf:label>Livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s">
                            <xf:label>Sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d">
                            <xf:label>Deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:select1 ref="@bookseller">
                        <xf:label>Expert libraire</xf:label>
                        <xf:itemset nodeset="instance('xprBoolean')/xpr:state">
                            <xf:label ref="xpr:label"/>
                            <xf:value ref="xpr:value"/>
                        </xf:itemset>
                    </xf:select1>
                </xf:group>
                <xf:group ref="xpr:maps">
                    <xf:label>Cartes</xf:label>
                    <xf:select1 ref=".">
                        <xf:label>Présence de cartes</xf:label>
                        <xf:itemset nodeset="instance('xprBoolean')/xpr:state">
                            <xf:label ref="xpr:label"/>
                            <xf:value ref="xpr:value"/>
                        </xf:itemset>
                    </xf:select1>
                </xf:group>
                <xf:group ref="xpr:portraits/xpr:family">
                    <xf:label>Portraits de famille</xf:label>
                    <xf:input ref="@quantity">
                        <xf:label>Quantité</xf:label>
                    </xf:input>
                </xf:group>
                <xf:group ref="xpr:portraits/xpr:expert">
                    <xf:label>Portraits du défunt</xf:label>
                    <xf:input ref="@quantity">
                        <xf:label>Quantité</xf:label>
                    </xf:input>
                </xf:group>
                <xf:group ref="xpr:drawings">
                    <xf:label>Dessins</xf:label>
                    <xf:input ref="@quantity">
                        <xf:label>Quantité</xf:label>
                    </xf:input>
                    <xf:textarea ref=".">
                        <xf:label>Description</xf:label>
                    </xf:textarea>
                </xf:group>
                <xf:group ref="xpr:paintings">
                    <xf:label>Peintures</xf:label>
                    <xf:input ref="@quantity">
                        <xf:label>Quantité</xf:label>
                    </xf:input>
                    <xf:textarea ref=".">
                        <xf:label>Description</xf:label>
                    </xf:textarea>
                </xf:group>
            </xf:group>
            <xf:group ref="xpr:tools">
                <xf:label>Instruments</xf:label>
                <xf:group ref="xpr:drawing">
                    <xf:label>Instruments à déssiner</xf:label>
                    <xf:select1 ref="@owned">
                        <xf:label>mention</xf:label>
                        <xf:itemset nodeset="instance('xprBoolean')/xpr:state">
                            <xf:label ref="xpr:label"/>
                            <xf:value ref="xpr:value"/>
                        </xf:itemset>
                    </xf:select1>
                </xf:group>
                <xf:group ref="xpr:measurement">
                    <xf:label>Instruments de mesure</xf:label>
                    <xf:textarea ref=".">
                        <xf:label>Remarques</xf:label>
                    </xf:textarea>
                </xf:group>
                <xf:group ref="xpr:scientific">
                    <xf:label>Objets scientifiques</xf:label>
                    <xf:repeat nodeset="*[not(self::xpr:noteworthy)]">
                        <xf:select1 ref="@owned">
                            <xf:label>
                                <xf:output ref="parent::*"/>
                            </xf:label>
                            <xf:itemset nodeset="instance('xprBoolean')/xpr:state">
                                <xf:label ref="xpr:label"/>
                                <xf:value ref="xpr:value"/>
                            </xf:itemset>
                        </xf:select1>
                    </xf:repeat>
                    <xf:textarea ref="xpr:noteworthy">
                        <xf:label>Éléments remarquables</xf:label>
                    </xf:textarea>
                </xf:group>
            </xf:group>
            <xf:group ref="xpr:objects">
                <xf:label>Objets</xf:label>
                <xf:textarea ref="xpr:artistic">
                    <xf:label>Objects artistiques</xf:label>
                </xf:textarea>
                <xf:textarea ref="xpr:religious">
                    <xf:label>Objects religieux</xf:label>
                </xf:textarea>
            </xf:group>
            <xf:group ref="xpr:buildingWorks">
                <xf:label>Constructions d'édifices</xf:label>
                <xf:repeat id="repeatBuildingWork"
                           nodeset="xpr:work">
                    <xf:label>Réalisation (construction)</xf:label>
                    <xf:input ref="xpr:client">
                        <xf:label>Client</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:type">
                        <xf:label>Type de travaux</xf:label>
                    </xf:input>
                    <xf:input ref="xpr:date/@when">
                        <xf:label>Date</xf:label>
                    </xf:input>
                    <xf:group ref="xpr:address">
                        <xf:label>Adresse</xf:label>
                        <xf:input ref="xpr:street">
                            <xf:label>Voie</xf:label>
                        </xf:input>
                        <xf:input ref="xpr:buildingNumber">
                            <xf:label>Numéro</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:group ref="xpr:cost">
                        <xf:label>Prix</xf:label>
                        <xf:input ref="@l">
                            <xf:label>Livres</xf:label>
                        </xf:input>
                        <xf:input ref="@s">
                            <xf:label>Sols</xf:label>
                        </xf:input>
                        <xf:input ref="@d">
                            <xf:label>Deniers</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:trigger class="delete">
                        <xf:label>&#10007;</xf:label>
                        <xf:delete nodeset="."
                                   at="1"
                                   if="count(//xpr:work) > 1"
                                   ev:event="DOMActivate"/>
                        <xf:help>Supprimer une réalisation.</xf:help>
                    </xf:trigger>
                </xf:repeat>
                <xf:trigger>
                    <xf:label>ajouter une réalisation</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert context="."
                                   origin="instance('xprInventoryCopy')/xpr:buildingWorks/xpr:work"
                                   nodeset="xpr:work[last()]"
                                   position="after"/>
                    </xf:action>
                </xf:trigger>
            </xf:group>
            <xf:select1 ref="xpr:report">
                <xf:label>Expertise z1j</xf:label>
                <xf:itemset nodeset="instance('xprBoolean')/xpr:state">
                    <xf:label ref="xpr:label"/>
                    <xf:value ref="xpr:value"/>
                </xf:itemset>
            </xf:select1>
            <xf:group ref="xpr:comments">
                <xf:label>Commentaires libres</xf:label>
                <xf:textarea ref=".">
                    <xf:label>Commentaires</xf:label>
                    <xf:help>Ce champ permet de signaler les collectionneurs ou les aspects remarquables.</xf:help>
                </xf:textarea>
            </xf:group>
            <span class="save">
                <xf:select1 ref="instance('xprInventory')/eac:control/eac:localControl/eac:term"
                            appearance="full"
                            incremental="true">
                    <xf:label>
                        <span>Statut</span>
                    </xf:label>
                    <xf:item>
                        <xf:label>En cours</xf:label>
                        <xf:value>in progress</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>À revoir</xf:label>
                        <xf:value>to revise</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>Terminée</xf:label>
                        <xf:value>completed</xf:value>
                    </xf:item>
                </xf:select1>
                <xf:dialog id="control">
                    <xf:group ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]">
                        <xf:input ref="eac:eventDescription">
                            <xf:label>Motif de la révision</xf:label>
                        </xf:input>
                    </xf:group>
                    <xf:trigger>
                        <xf:label>Annuler</xf:label>
                        <xf:hide ev:event="DOMActivate"
                                 dialog="control"/>
                    </xf:trigger>
                    <xf:trigger>
                        <xf:label>Enregistrer</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:dispatch name="submission"
                                         targetid="inventory"/>
                        </xf:action>
                    </xf:trigger>
                </xf:dialog>
                <xf:trigger>
                    <xf:label>Enregistrer</xf:label>
                    <!--we are using xf:delete to distinguish which submission module we need (prosopo or inventory)-->
                    <xf:delete nodeset="instance('xprProsopo')/*"
                               ev:event="DOMActivate"/>
                    <xf:action if="/eac:inventory/@xml:id"
                               ev:event="DOMActivate">
                        <xf:show dialog="control"/>
                    </xf:action>
                    <xf:action if="not(/eac:inventory/@xml:id)"
                               ev:event="DOMActivate">
                        <xf:dispatch name="submission"
                                     targetid="inventory"/>
                    </xf:action>
                </xf:trigger>
            </span>
        </xf:case>
        <xf:case id="newEntitiesPanel">
            <xf:group ref="instance('xprEntities')">
                <xf:label>Nouvelle(s) entité(s)</xf:label>
                <xf:repeat nodeset="instance('xprEntities')//xpr:entity[@localType='new']">
                    <xf:group ref="eac:eac-cpf">
                        <xf:var name="newEntity"
                                value="."/>
                        <xf:label>Nouvelle entrée</xf:label>
                        <xf:select1 ref="eac:cpfDescription/eac:identity/eac:entityType"
                                    appearance="full">
                            <xf:label>Type d'entité</xf:label>
                            <xf:item>
                                <xf:label>personne</xf:label>
                                <xf:value>person</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity/@localType"
                                                 value="''"/>
                                    <xf:delete ref="ancestor::eac:eac-cpf/eac:cpfDescription//eac:nameEntry[eac:alternativeForm]"/>
                                    <xf:insert context="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity"
                                               origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:identity/eac:nameEntry[eac:alternativeForm]"
                                               nodeset="eac:nameEntry[eac:authorizedForm]"
                                               position="after"/>
                                    <xf:delete ref="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity/eac:nameEntry[eac:alternativeForm]//eac:part[@localType='officeName']"/>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>office</xf:label>
                                <xf:value>corporateBody</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity/@localType"
                                                 value="''"/>
                                    <xf:delete ref="ancestor::eac:eac-cpf/eac:cpfDescription//eac:nameEntry[eac:alternativeForm]"/>
                                    <xf:insert context="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity"
                                               origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:identity/eac:nameEntry[eac:alternativeForm]"
                                               nodeset="eac:nameEntry[eac:authorizedForm]"
                                               position="after"/>
                                    <xf:delete ref="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity/eac:nameEntry[eac:alternativeForm]//eac:part[not(@localType='officeName')]"/>
                                </xf:action>
                            </xf:item>
                            <xf:item>
                                <xf:label>famille</xf:label>
                                <xf:value>family</xf:value>
                                <xf:action ev:event="xforms-select">
                                    <xf:setvalue ref="ancestor::eac:eac-cpf/eac:cpfDescription//eac:identity/@localType"
                                                 value="'family'"/>
                                    <xf:delete ref="ancestor::eac:eac-cpf/eac:cpfDescription//eac:nameEntry[eac:alternativeForm]"/>
                                    <xf:insert context="ancestor::eac:eac-cpf/eac:cpfDescription/eac:identity"
                                               origin="instance('xprProsopoCopy')/eac:cpfDescription/eac:identity/eac:nameEntry[eac:alternativeForm]"
                                               nodeset="eac:nameEntry[eac:authorizedForm]"
                                               position="after"/>
                                    <xf:delete ref="ancestor::eac:eac-cpf/eac:cpfDescription//eac:identity/eac:nameEntry[eac:alternativeForm]//eac:part[not(@localType='surname')]"/>
                                </xf:action>
                            </xf:item>
                        </xf:select1>
                        <xf:select1 ref="eac:cpfDescription/eac:identity/@localType" appearance="full">
                            <xf:label>Répertoire</xf:label>
                            <xf:itemset model="prosopo" nodeset="instance('xprEntitiesTypes')/xpr:identity[@type = $newEntity//eac:entityType]">
                                <xf:label ref="xpr:label"/>
                                <xf:value ref="xpr:value"/>
                            </xf:itemset>
                        </xf:select1>
                        <xf:input ref="eac:cpfDescription/eac:identity/eac:nameEntry[child::eac:authorizedForm]/eac:part">
                            <xf:label>Nom</xf:label>
                            <xf:action ev:event="xforms-value-changed">
                                <xf:setvalue ref="ancestor::xpr:entity/xpr:label" value="current()"/>
                            </xf:action>
                        </xf:input>
                        <xf:group ref="eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:fromDate">
                            <xf:label>Naissance</xf:label>
                            <xf:input ref="@standardDate">
                                <xf:label>Certaine</xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter">
                                <xf:label>Avant le</xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore">
                                <xf:label>Après le</xf:label>
                            </xf:input>
                        </xf:group>
                        <xf:group ref="eac:cpfDescription/eac:description/eac:existDates/eac:dateRange/eac:toDate">
                            <xf:label>Décès</xf:label>
                            <xf:input ref="@standardDate">
                                <xf:label>Certaine</xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter">
                                <xf:label>Avant le</xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore">
                                <xf:label>Après le</xf:label>
                            </xf:input>
                        </xf:group>
                        <xf:group
                            ref="eac:cpfDescription[eac:identity/eac:entityType = 'person']/eac:description/eac:localDescription[@localType='sex']">
                            <xf:select1 ref="eac:term">
                                <xf:label>Sexe</xf:label>
                                <xf:item>
                                    <xf:label>Homme</xf:label>
                                    <xf:value>male</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Femme</xf:label>
                                    <xf:value>female</xf:value>
                                </xf:item>
                            </xf:select1>
                        </xf:group>
                    </xf:group>
                </xf:repeat>
                <xf:trigger>
                    <xf:label>Ajouter une nouvelle entité</xf:label>
                    <xf:insert context="instance('xprEntities')"
                               origin="instance('xprNewEntries')/xpr:entity"
                               nodeset="xpr:entity"
                               at="last()"
                               position="after"
                               ev:event="DOMActivate"/>
                    <xf:insert context="instance('xprEntities')/xpr:entity[@localType = 'new'][@xml:id = '']"
                               origin="instance('xprProsopoCopy')"
                               nodeset="xpr:label"
                               position="after"
                               ev:event="DOMActivate"/>
                    <xf:setvalue ref="instance('xprEntities')/xpr:entity[@localType = 'new'][@xml:id = '']//eac:entityId
                                 | instance('xprEntities')/xpr:entity[@localType = 'new'][@xml:id = '']/@xml:id"
                                 value="concat('local-id-participant', number(count(instance('xprEntities')/xpr:entity[@localType = 'new'])))"
                                 ev:event="DOMActivate"/>
                </xf:trigger>
            </xf:group>
        </xf:case>
    </xf:switch>
</form>
